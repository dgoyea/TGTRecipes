!function(){var t,e,i;!function(s){function o(t,e){return x.call(t,e)}function a(t,e){var i,s,o,a,n,r,h,d,l,c,u,p=e&&e.split("/"),m=b.map,v=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=t.split("/"),n=t.length-1,b.nodeIdCompat&&$.test(t[n])&&(t[n]=t[n].replace($,"")),t=p.concat(t),l=0;l<t.length;l+=1)if(u=t[l],"."===u)t.splice(l,1),l-=1;else if(".."===u){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||v)&&m){for(i=t.split("/"),l=i.length;l>0;l-=1){if(s=i.slice(0,l).join("/"),p)for(c=p.length;c>0;c-=1)if(o=m[p.slice(0,c).join("/")],o&&(o=o[s])){a=o,r=l;break}if(a)break;!h&&v&&v[s]&&(h=v[s],d=l)}!a&&h&&(a=h,r=d),a&&(i.splice(0,r,a),t=i.join("/"))}return t}function n(t,e){return function(){return p.apply(s,y.call(arguments,0).concat([t,e]))}}function r(t){return function(e){return a(e,t)}}function h(t){return function(e){f[t]=e}}function d(t){if(o(g,t)){var e=g[t];delete g[t],w[t]=!0,u.apply(s,e)}if(!o(f,t)&&!o(w,t))throw new Error("No "+t);return f[t]}function l(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return b&&b.config&&b.config[t]||{}}}var u,p,m,v,f={},g={},b={},w={},x=Object.prototype.hasOwnProperty,y=[].slice,$=/\.js$/;m=function(t,e){var i,s=l(t),o=s[0];return t=s[1],o&&(o=a(o,e),i=d(o)),o?t=i&&i.normalize?i.normalize(t,r(e)):a(t,e):(t=a(t,e),s=l(t),o=s[0],t=s[1],o&&(i=d(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:i}},v={require:function(t){return n(t)},exports:function(t){var e=f[t];return"undefined"!=typeof e?e:f[t]={}},module:function(t){return{id:t,uri:"",exports:f[t],config:c(t)}}},u=function(t,e,i,a){var r,l,c,u,p,b,x=[],y=typeof i;if(a=a||t,"undefined"===y||"function"===y){for(e=!e.length&&i.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(u=m(e[p],a),l=u.f,"require"===l)x[p]=v.require(t);else if("exports"===l)x[p]=v.exports(t),b=!0;else if("module"===l)r=x[p]=v.module(t);else if(o(f,l)||o(g,l)||o(w,l))x[p]=d(l);else{if(!u.p)throw new Error(t+" missing "+l);u.p.load(u.n,n(a,!0),h(l),{}),x[p]=f[l]}c=i?i.apply(f[t],x):void 0,t&&(r&&r.exports!==s&&r.exports!==f[t]?f[t]=r.exports:c===s&&b||(f[t]=c))}else t&&(f[t]=i)},t=e=p=function(t,e,i,o,a){if("string"==typeof t)return v[t]?v[t](e):d(m(t,e).f);if(!t.splice){if(b=t,b.deps&&p(b.deps,b.callback),!e)return;e.splice?(t=e,e=i,i=null):t=s}return e=e||function(){},"function"==typeof i&&(i=o,o=a),o?u(s,t,e,i):setTimeout(function(){u(s,t,e,i)},4),p},p.config=function(t){return p(t)},t._defined=f,i=function(t,e,i){e.splice||(i=e,e=[]),o(f,t)||o(g,t)||(g[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("libs/almond",function(){}),i("sandbox",[],function(){function t(t,i){return e(t,i)}var e=window.joms.jQuery,i=window._,s=window.Backbone;s.$=e,i.pick(i,["each","map","filter","union","intersection","without","bind","debounce","defer","keys","extend","pick","omit","isArray","isNumber","isString","isUndefined","uniqueId"]),i.extend(t,s.Events,i,{mvc:{Model:s.Model,Models:s.Collection,View:s.View},ajax:e.ajax,param:e.param,noop:function(){}}),t.__extend=t.extend,t._$extend=e.extend,t.extend=function(){var e=arguments[0]===!0;return t[e?"_$extend":"__extend"].apply(null,arguments)},t.ua=navigator.userAgent;var o=t.ua.toLowerCase();return t.mobile=!!o.match(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i),t.webkit=!!o.match(/webkit/i),t.ie=!!o.match(/msie/i),t.ieVersion=t.ie&&+o.match(/msie (\d+)\./i)[1],t.xpriment=!t.ie&&1,t(document.body).on("click",function(e){t.trigger("click",t(e.target))}),t}),i("views/base",["sandbox"],function(t){return t.mvc.View.extend({assign:function(e,i){t.isArray(e)||(e=[[e,i]]),t.each(e,function(t){t[1].setElement(t[0]).render()})},show:function(){this.isHidden()&&(this.$el.show(),this.trigger("show"))},hide:function(){this.isHidden()||(this.$el.hide(),this.trigger("hide"))},toggle:function(){this.isHidden()?this.show():this.hide()},isHidden:function(){return"none"===this.el.style.display}})}),i("app",[],function(){var t;return t=window.joms_assets_url||"",t=t.replace(/js\/$/,""),{staticUrl:t,legacyUrl:t+"../../"}}),i("utils/ajax",["sandbox"],function(t){function e(e){return e=t.extend({},s,e||{}),e.url=window.jax_live_site,e.data=i(e.fn,e.data),t.ajax(e)}function i(e,i){var s={};s.option="community",s.no_html=1,s.task="azrul_ajax",s.func=e,s[window.jax_token_var]=1,t.isArray(i)||(i=[]);for(var o,a=0;a<i.length;a++)o=i[a],t.isString(o)&&(o=o.replace(/"/g,"&quot;")),t.isArray(o)||(o=["_d_",o]),s["arg"+(a+2)]=JSON.stringify(o);return s}var s={type:"post",data:{},dataType:"json",error:t.noop,success:t.noop,complete:t.noop};return e}),i("utils/constants",["sandbox"],function(t){function e(e){if("string"==typeof e&&e.length){joms&&joms.constants&&(t.extend(!0,s,joms&&joms.constants),delete joms.constants);var i=s;for(e=e.split(".");e.length;)i=i[e.shift()];return i}}function i(t,e){var i,o,a;if("string"==typeof t&&t.length){for(i=s,o=t.split("."),a=t.length;o.length-1;)t=o.shift(),i[t]||(i[t]={}),i=i[t];i[t]=e}}var s={};return{get:e,set:i}}),i("views/postbox/default",["sandbox","app","views/base","utils/ajax","utils/constants"],function(t,e,i,s,o){return i.extend({subviews:{},template:function(){throw new Error("Method not implemented.")},events:{"click li[data-tab]":"onToggleDropdown","click button.joms-postbox-cancel":"onCancel","click button.joms-postbox-save":"onPost"},initialize:function(t){t&&t.single&&(this.single=!0),this.subflags={},this.reset()},render:function(){var t=this.getTemplate();return this.$el.replaceWith(t),this.setElement(t),this.$tabs=this.$(".joms-postbox-tab"),this.$action=this.$(".joms-postbox-action").hide(),this.$loading=this.$(".joms-postbox-loading").hide(),this.$save=this.$(".joms-postbox-save").hide(),this},show:function(){this.showInitialState(),i.prototype.show.apply(this)},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.trigger("show:initial")},showMainState:function(){this.$tabs.show(),this.$action.show(),this.trigger("show:main")},reset:function(){this.data={},this.data.text="",this.data.attachment={};for(var t in this.subflags)this.subviews[t].reset(),this.subviews[t].hide()},value:function(e){var i=t.extend({},this.getStaticAttachment(),this.data.attachment);return[this.data.text,e?i:JSON.stringify(i)]},validate:t.noop,onToggleDropdown:function(e){var i=t(e.currentTarget);if(!i.data("bypass")){var s=i.data("tab");if(this.subviews[s]){if(this.subflags[s]||this.initSubview(s),!this.subviews[s].isHidden())return void this.subviews[s].hide();for(var o in this.subflags)o!==s&&this.subviews[o].hide();this.subviews[s].show()}}},onCancel:function(){e.postbox&&e.postbox.value&&(e.postbox.value=!1),this.saving||this.showInitialState()},onPost:function(){if(!this.saving){var e=this.validate();if(e)return void window.alert(e);this.saving=!0,this.$loading.show();var i=this;s({fn:"system,ajaxStreamAdd",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}},onPostSuccess:function(e){var i,s=this.parseResponse(e);if(s){i=t("#activity-stream-container,.joms-stream__container"),i.html(s);var o=t(".joms-activity-filter-action .joms-activity-filter-status");o&&o.length&&o.html(o.data("default"))}},initSubview:function(t,e){var i=t.replace(/^./,function(t){return t.toUpperCase()});this.subflags[t]||(this.subviews[t]=new this.subviews[t](e),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"init",this["on"+i+"Init"]),this.listenTo(this.subviews[t],"show",this["on"+i+"Show"]),this.listenTo(this.subviews[t],"hide",this["on"+i+"Hide"]),this.listenTo(this.subviews[t],"select",this["on"+i+"Select"]),this.listenTo(this.subviews[t],"remove",this["on"+i+"Remove"]),this.subflags[t]=!0)},getSubviewElement:function(){var e=t("<div>").hide().appendTo(this.$el);return e},parseResponse:function(t){var e,i="activity-stream-container";if(t.html)return t.html;if(t&&t.length)for(var s=0;s<t.length;s++)if(t[s][1]===i){e=t[s][3];break}return e},getTemplate:function(){var e=this.template({juri:o.get("juri")});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},o.get("postbox.attachment")||{},{type:""}),this.staticAttachment)}})}),i("utils/image",[],function(){function t(t,e){this.images=[],this.loaded=[],this.processed=0,this.callback=e,t&&t.length||(t=[]);for(var i=/^(http:|https:)?\/\/([a-z0-9-]+\.)+[a-z]{2,4}\/.*$/i,s=0;s<t.length;s++)t[s].match(i)&&this.images.push(t[s])}function e(e,i){var s=new t(e,i);s.load()}return t.prototype.load=function(){if(!this.images||!this.images.length)return void this.callback([]);for(var t,e=0;e<this.images.length;e++)t=new Image,t.onload=this.onload,t.onerror=this.onerror,t.onabort=this.onabort,t.preloader=this,t.src=t._src=this.images[e]},t.prototype.onload=function(){this.preloader.loaded.push(this._src),this.preloader.oncomplete()},t.prototype.onerror=function(){this.preloader.oncomplete()},t.prototype.onabort=function(){this.preloader.oncomplete()},t.prototype.oncomplete=function(){var t,e=[];if(this.processed++,this.processed>=this.images.length){for(t=0;t<this.images.length;t++)this.loaded.indexOf(this.images[t])>-1&&e.push(this.images[t]);this.callback(e)}},{preload:e}}),i("utils/language",["sandbox"],function(t){function e(e){if("string"==typeof e&&e.length){joms&&joms.language&&(t.extend(!0,i,joms&&joms.language),delete joms.language);var s=i;for(e=e.split(".");e.length;)s=s[e.shift()];return s}}var i={};return{get:e}}),i("views/postbox/fetcher",["sandbox","views/base","utils/ajax","utils/image","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/postbox/fetcher"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur","click .joms-fetched-previmg":"prevImage","click .joms-fetched-nextimg":"nextImage"},initialize:function(){var t=o.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||""},fetch:function(e){var s=/^(|.*\s)((https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,4}(:\d+)?(\/.*)?)(\s.*|)$/i,o=e.match(s);!this.fetching&&o&&(e=o[2],this.fetching=!0,this.fetched=!1,delete this.url,this.trigger("fetch:start"),i({fn:"system,ajaxGetFetchUrl",data:[e],success:t.bind(this.render,this),complete:t.noop}))},render:function(e){if(e=e&&e[2]&&e[2][3]&&e[2][3][0]||!1){var i;try{i=JSON.parse(e)}catch(a){}if(i){this.fetched=!0,this.url=i.url||"";var n={title:i.title||"",titlePlaceholder:this.titlePlaceholder,description:i.description||"",descPlaceholder:this.descPlaceholder,image:(i.image||[]).concat(i["og:image"]||[]),lang:{prev:(o.get("prev")||"").toLowerCase(),next:(o.get("next")||"").toLowerCase(),cancel:(o.get("cancel")||"").toLowerCase()}};this.url.match(/^https?:\/\//i)||(this.url="http://"+this.url);for(var r=0;r<n.image.length;r++)n.image[r].match(/^(http:|https:)?\/\//i)||(n.image[r]="//"+n.image[r]);s.preload(n.image,t.bind(function(t){n.image=t,this.$el.html(this.template(n)),this.$images=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.fetching=!1,this.trigger("fetch:done")},this))}}},change:function(e){var i=t(e),s=i.prev("span"),o=i.val().replace(/^\s+|\s+$/g,"");o||(o=i.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder),i.hide(),s.text(o).show()},remove:function(){delete this.url,e.prototype.remove.apply(this),this.trigger("remove")},prevImage:function(){var t=this.$images.filter(":visible"),e=t.prev();e.length&&(t.hide(),e.show())},nextImage:function(){var t=this.$images.filter(":visible"),e=t.next();e.length&&(t.hide(),e.show())},value:function(){return!this.fetching&&this.url?[this.url,this.$images&&this.$images.filter(":visible").attr("src"),this.$title&&this.escapeValue(this.$title.val()),this.$description&&this.escapeValue(this.$description.val())]:void 0},onClose:function(){this.remove()},onFocus:function(e){var i=t(e.currentTarget),s=i.next("input,textarea");i.hide(),s.show(),setTimeout(function(){s[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){if(t=t&&t[2]&&t[2][3]&&t[2][3][0]||!1){var e;try{e=JSON.parse(t)}catch(i){}return e}},escapeValue:function(t){return"string"!=typeof t?t:t.replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"')}})}),i("views/inputbox/base",["sandbox","views/base","utils/constants"],function(t,e,i){return e.extend({events:{"focus textarea":"onFocus","keydown textarea":"onKeydownProxy","input textarea":"onInput","paste textarea":"onPaste","blur textarea":"onBlur"},initialize:function(e){t.mobile||(this.onInput=this.onKeydown,this.onKeydownProxy=this.onKeydown,this.updateCharCounterProxy=this.updateCharCounter),e||(e={}),this.flags={},this.flags.attachment=e.attachment,this.flags.charcount=e.charcount,this.listenTo(t,"postbox:tab:change",this.reset)},render:function(){this.$mirror=this.$("span.input"),this.$textarea=this.$("textarea.input"),this.placeholder=this.$textarea.attr("placeholder"),this.flags.attachment&&(this.$attachment=t("<span class=attachment>").insertAfter(this.$mirror)),this.reset()},set:function(t){this.$textarea.val(t),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.$textarea.val(""),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){return this.$textarea[0].value},onFocus:function(){this.trigger("focus")},onKeydown:function(e){"undefined"==typeof this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0);var s=this.value();if(s.length>=this.maxchar&&this.isPrintable(e))return void e.preventDefault();var o=this;t.defer(function(){o.updateInput(e)})},onKeydownProxy:t.debounce(function(t){this.onKeydown(t)},10),onInput:function(){this.onKeydownProxy()},onPaste:function(){var t=this;this.onKeydownProxy(function(){t.trigger("paste",t.$textarea[0].value,13)})},onBlur:function(){this.trigger("blur",this.$textarea[0].value,13)},updateInput:function(t){var e=t&&t.keyCode||!1,s=this.$textarea[0],o=s.value,a=""===o.replace(/^\s+|\s+$/g,"");a&&(s.value=o=""),"undefined"==typeof this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0),o.length>this.maxchar&&(s.value=o=o.substr(0,this.maxchar)),this.$mirror.html(this.normalize(o)+"."),this.$textarea.css("height",this.$mirror.height()),this.flags.charcount&&this.updateCharCounterProxy(),this.trigger("keydown",o,e),"function"==typeof t&&t()},updateAttachment:t.noop,updateCharCounterProxy:t.debounce(function(){this.updateCharCounter()},300),updateCharCounter:function(){return"undefined"==typeof this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0),this.$charcount||(this.$charcount=this.$(".charcount")),!this.maxchar||this.maxchar<=0?void this.$charcount.hide():void this.$charcount.html(this.maxchar-this.$textarea[0].value.length).show()},isPrintable:function(t){if(!t)return!1;if((t.crtlKey||t.metaKey)&&!t.altKey&&!t.shiftKey)return!1;var e=t&&t.keyCode,i=13===e||32===e||e>47&&58>e||e>64&&91>e||e>95&&112>e||e>185&&193>e||e>218&&223>e;return i},normalize:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},resetTextntags:function(e,s){var o=this;e=t(e),e.data("initialized")||(e.data("initialized",1),e.textntags({triggers:{"@":{uniqueTags:!0,minChars:1}},onDataRequest:function(e,s,o,a){var n,r,h=i.get("friends")||[];n=function(){s=s.toLowerCase(),h=t.filter(h,function(t){return t.name.toLowerCase().indexOf(s)>-1}),a(h)},"fetching"!==h?n():r=setInterval(function(){h=i.get("friends")||[],"fetching"!==h&&(clearInterval(r),n())},100)}}).bind("tagsAdded.textntags",function(){o.updateInput()}).bind("tagsRemoved.textntags",function(){o.updateInput()})),e.textntags("val",s)}})}),i("views/inputbox/status",["sandbox","views/inputbox/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/inputbox/status"],initialize:function(){var t,s,o,a;if(e.prototype.initialize.apply(this,arguments),this.moods=i.get("moods"),t={},this.moods&&this.moods.length)for(a=0;a<this.moods.length;a++)o=this.moods[a].id,s=[o,this.moods[a].description],this.moods[a].custom&&(s[2]=this.moods[a].image),t[o]=s;this.moods=t},render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},set:function(t){this.resetTextntags(this.$textarea,t),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.resetTextntags(this.$textarea,""),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){return this.textareaValue},updateInput:function(){e.prototype.updateInput.apply(this,arguments);var t=this;this.$textarea.textntags("val",function(e){t.textareaValue=e})},updateAttachment:function(t,e){var i=[];return this.mood=t||t===!1?t:this.mood,this.location=e||e===!1?e:this.location,this.location&&this.location.name&&i.push("<b>"+s.get("at")+" "+this.location.name+"</b>"),this.mood&&this.moods[this.mood]&&i.push("undefined"!=typeof this.moods[this.mood][2]?'<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>":'<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>"),i.length?(this.$attachment.html(" &nbsp;&mdash; "+i.join(" and ")+"."),void this.$textarea.removeAttr("placeholder")):(this.$attachment.html(""),void this.$textarea.attr("placeholder",this.placeholder))},getTemplate:function(){var e=s.get("status.status_hint")||"",i=this.template({placeholder:e});return t(i)}})}),i("views/dropdown/base",["sandbox","views/base"],function(t,e){return e.extend({initialize:function(){this.listenTo(t,"click",this._onDocumentClick)},_onDocumentClick:function(t){t.closest(".joms-postbox").length||this.hide()}})}),i("views/dropdown/mood",["sandbox","views/dropdown/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/dropdown/mood"],events:{"click li":"onSelect","click .joms-remove-button":"onRemove"},render:function(){var e,o,a,n,r,h,d;if(this.moods=i.get("moods"),e=[],o={},this.moods&&this.moods.length)for(d=0;d<this.moods.length;d++)a=this.moods[d].id,n=[a,this.moods[d].title],this.moods[d].custom&&(n[2]=this.moods[d].image),e.push(n),o[a]=n;return this.moods=o,r=this.template({items:e,language:{status:s.get("status")||{}}}),h=t(r).hide(),this.$el.replaceWith(h),this.setElement(h),this.$btnremove=this.$(".joms-remove-button").hide(),this},select:function(t){this.moods[t]&&(this.$btnremove.show(),this.trigger("select",this.mood=t))},value:function(){return this.mood},reset:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("reset")},onSelect:function(e){var i=t(e.currentTarget),s=i.attr("data-mood");this.select(s),this.hide()},onRemove:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("remove")}})}),i("views/dropdown/location",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){var s=i.get("geolocation")||{};return e.extend({template:{div:joms.jst["html/dropdown/location"],list:joms.jst["html/dropdown/location-list"]},placeholders:{loading:s.loading||"",loaded:s.loaded||"",error:s.error||""},initialize:function(){e.prototype.initialize.apply(this),this.locations=[],this.location=!1,this.listenTo(t,"postbox:tab:change",this.onRemove)},events:{"keyup input.joms-postbox-keyword":"onKeyup","click li":"onSelect","click button.joms-add-location":"onAdd","click button.joms-remove-location":"onRemove"},render:function(){return this.$el.html(this.getTemplate()),this.$keyword=this.$(".joms-postbox-keyword"),this.$list=this.$(".joms-postbox-locations"),this.$map=this.$(".joms-postbox-map"),this.$btnadd=this.$(".joms-add-location").hide(),this.$btnremove=this.$(".joms-remove-location").hide(),this.$keyword.attr("placeholder",this.placeholders.loading),this.detectLocation(),this},show:function(){this.$el.show(),this.trigger("show")},hide:function(){this.$el.hide(),this.trigger("hide")},toggle:function(){var t="none"===this.el.style.display;t?this.show():this.hide()},filter:function(){var t=this.$keyword.val().replace(/^\s+|\s+$/,""),e=this.locations;if(t.length){t=new RegExp(t,"i"),e=[];for(var i,s=0;s<this.locations.length;s++)i=this.locations[s],i=[i.name,i.vicinity].join(" "),i.match(t)&&e.push(this.locations[s])}this.draw(e)},draw:function(e){var s=this.template.list({language:{geolocation:i.get("geolocation")},items:e});this.filtered=e,t.mobile?this.$list.html(s).css({height:"160px",overflowY:"auto"}):this.$list.html(s).slimScroll({height:"150px",alwaysVisible:!0})},select:function(t){var e=this.filtered[t];e&&(this.location=e,this.$map.show(),this.$keyword.val(e.name),this.map&&this.marker&&this.marker.setMap(this.map),this.showMap(e.latitude,e.longitude),this.$btnadd.show(),this.$btnremove.hide())},value:function(){var t=[];return this.location?(t.push(this.location.name),t.push(this.location.latitude),t.push(this.location.longitude),t):!1},reset:function(){this.location=!1,this.marker&&this.marker.setMap(null),this.$keyword.val(""),this.$btnadd.hide(),this.$btnremove.hide(),this.trigger("reset")},onKeyup:t.debounce(function(){this.filter()},100),onSelect:function(e){var i=t(e.currentTarget),s=i.attr("data-index");this.select(+s)},onAdd:function(){this.location&&(this.trigger("select",this.location),this.$btnadd.hide(),this.$btnremove.show(),this.hide())},onRemove:function(){this.reset(),this.trigger("remove"),this.hide(),this.filter()},initMap:function(e){var i=t("<div>").prependTo(this.$map);i.css("height",110);var s={center:e,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAD,mapTypeControl:!1,disableDefaultUI:!0,draggable:!1,scaleControl:!1,scrollwheel:!1,navigationControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0};this.map=new google.maps.Map(i[0],s),this.marker=new google.maps.Marker({draggable:!1,map:this.map}),this.marker.setAnimation(null)},showMap:function(e,i){var s=t.isUndefined(i)?e:new google.maps.LatLng(e,i);this.map||this.initMap(s),this.marker.setPosition(s),this.map.panTo(s)},detectLocation:function(){this.sensor=!1;var e=this;joms.map.execute(function(){navigator.geolocation.getCurrentPosition(t.bind(e.detectLocationSuccess,e),t.bind(e.detectLocationFallback,e),{timeout:1e4})})},detectLocationSuccess:function(t){var e=t&&t.coords||{},i=e.latitude,s=e.longitude;return i&&s?(this.sensor=!0,void this.detectLocationNearby(i,s)):void this.detectLocationFailed()},detectLocationFallback:function(){var e=!1,i=this;t.ajax({url:"//freegeoip.net/json/",dataType:"jsonp",success:function(t){var s=t.latitude,o=t.longitude;s&&o&&(e=!0,i.detectLocationNearby(s,o))},complete:function(){e||i.detectLocationFailed()}})},detectLocationFailed:function(){this.$keyword.attr("placeholder",this.placeholders.error)},detectLocationNearby:function(e,i){var s=t.isUndefined(i)?e:new google.maps.LatLng(e,i);this.initMap(s);var o=new google.maps.places.PlacesService(this.map),a={location:new google.maps.LatLng(e,i),radius:2e3,sensor:this.sensor};this.locations=[];var n=this;o.nearbySearch(a,function(e,i){if(i!==google.maps.places.PlacesServiceStatus.OK)return void n.detectLocationFailed();if(!t.isArray(e))return void n.detectLocationFailed();for(var s,o,a,r=["administrative_area_level_1","administrative_area_level_2","administrative_area_level_3","colloquial_area","country","floor","geocode","intersection","locality","natural_feature","neighborhood","political","point_of_interest","post_box","postal_code","postal_code_prefix","postal_town","premise","room","route","street_address","street_number","sublocality","sublocality_level_4","sublocality_level_5","sublocality_level_3","sublocality_level_2","sublocality_level_1","subpremise","transit_station"],h=0;h<e.length;h++){for(s=e[h],o=s&&s.types||[],a=!1;!a&&o&&o.length;)r.indexOf(o.shift())>=0&&(a=!0);a||n.locations.push({name:s.name,latitude:s.geometry.location.lat(),longitude:s.geometry.location.lng(),vicinity:s.vicinity})}n.$keyword.attr("placeholder",n.placeholders.loaded),n.filter()})},getTemplate:function(){var t=this.template.div({language:{geolocation:i.get("geolocation")||{}}});return t}})}),i("views/dropdown/privacy",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/dropdown/privacy"],events:{"click li":"select"},privacies:{"public":[10,"globe"],site_members:[20,"users"],friends:[30,"user"],me:[40,"lock"]},privmaps:{"public":"10",site_members:"20",friends:"30",me:"40",0:"public",10:"public",20:"site_members",30:"friends",40:"me"},initialize:function(s){e.prototype.initialize.apply(this),this.privkeys=t.keys(this.privacies),s&&s.privacylist&&s.privacylist.length&&(this.privkeys=t.intersection(this.privkeys,s.privacylist));var o=i.get("privacy")||{};for(var a in this.privacies)this.privacies[a][2]=o[a]||a,this.privacies[a][3]=o[a+"_desc"]||a;this.defaultPrivacy=this.privkeys[0],"undefined"!=typeof s.defaultPrivacy&&(s.defaultPrivacy=""+s.defaultPrivacy,s.defaultPrivacy.match(/^\d+$/)&&(s.defaultPrivacy=this.privmaps[s.defaultPrivacy]||this.defaultPrivacy),this.defaultPrivacy=s.defaultPrivacy)},render:function(){for(var t,e=[],i=0;i<this.privkeys.length;i++)t=this.privkeys[i],e[i]=[t,this.privacies[t][1],this.privacies[t][2],this.privacies[t][3]];return this.$el.html(this.template({items:e})),this.setPrivacy(this.defaultPrivacy),this},select:function(e){var i=t(e.currentTarget),s=i.attr("data-priv");this.setPrivacy(s),this.hide()},setPrivacy:function(t){var e={};this.privkeys.indexOf(t)>=0&&(this.privacy=this.privacies[t][0],e.icon=this.privacies[t][1],e.label=this.privacies[t][2].toLowerCase(),this.trigger("select",e))},value:function(){return this.privacy},reset:function(){this.setPrivacy(this.defaultPrivacy)}})}),i("views/postbox/status",["sandbox","app","views/postbox/default","views/postbox/fetcher","views/inputbox/status","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","utils/constants","utils/language"],function(t,e,i,s,o,a,n,r,h,d){return i.extend({subviews:{mood:a,location:n,privacy:r},template:joms.jst["html/postbox/status"],events:t.extend({},i.prototype.events,{"click li[data-tab=photo]":"onAddPhoto","click li[data-tab=video]":"onAddVideo"}),initialize:function(){var e=h.get("settings")||{};(this.inheritPrivacy=e.isGroup||e.isEvent||!e.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),this.enableMood=+h.get("conf.enablemood"),this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),this.enableLocation=+h.get("conf.enablelocation"),this.enableLocation||(this.subviews=t.omit(this.subviews,"location")),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$fetcher=this.$(".joms-postbox-fetched"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&(this.$tabprivacy.next().length?this.$tabprivacy.remove():this.$tabprivacy.css({visibility:"hidden"})),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onInputUpdate);var e,s;return this.inheritPrivacy||(s=h.get("settings")||{},s.isProfile&&s.isMyProfile&&(e=h.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{defaultPrivacy:e||"public"})),this.single&&this.listenTo(t,"click",this.onDocumentClick),this},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:t.noop,onInputFocus:function(){this.showMainState()},onInputUpdate:function(e,i){var o;if(e=e||"",this.togglePostButton(e),32===i||13===i){if(this.fetcher&&(this.fetcher.fetching||this.fetcher.fetched))return;this.fetcher&&this.fetcher.remove(),o=t("<div>").appendTo(this.$fetcher),this.fetcher=new s,this.fetcher.setElement(o),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(e.replace(/^\s+|\s+$/g,""))}},onFetchStart:function(){this.saving=!0,this.$loading.show()},onFetchDone:function(){this.$loading.hide(),this.saving=!1},onFetchRemove:function(){this.fetcher=!1},onDocumentClick:function(t){if(!t.closest(".joms-postbox").length){var e=this.inputbox.value();e=e.replace(/^\s+|\s+$/g,""),e||this.showInitialState()}},onMoodSelect:function(t){this.inputbox.updateAttachment(t),this.togglePostButton()},onMoodRemove:function(){this.inputbox.updateAttachment(!1),this.togglePostButton()},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t),this.togglePostButton()},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1),this.togglePostButton()},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},onAddPhoto:function(){e.postbox||(e.postbox={}),e.postbox.value=this.value(!0),e.postbox.value[0]=e.postbox.value[0].replace(/\\n/g,"\n"),t.trigger("postbox:photo")},onAddVideo:function(){e.postbox||(e.postbox={}),e.postbox.value=this.value(!0),e.postbox.value[0]=e.postbox.value[0].replace(/\\n/g,"\n"),t.trigger("postbox:video")},getTemplate:function(){var e=h.get("settings")||{},i=h.get("conf")||{},s=!0,o=!0;e.isEvent?s=o=!1:(e.isProfile||e.isGroup)&&(i.enablephotos||(s=!1),i.enablevideos||(o=!1));var a=this.template({juri:h.get("juri"),enablephoto:s,enablevideo:o,language:{postbox:d.get("postbox")||{},status:d.get("status")||{}}});return t(a).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},h.get("postbox.attachment")||{},{type:"message"}),this.staticAttachment)},togglePostButton:function(t){var e=!1;t&&(e=!0),!e&&this.subflags.mood&&(e=this.subviews.mood.value()),!e&&this.subflags.location&&(e=this.subviews.location.value()),this.$save[e?"show":"hide"]()}})}),i("views/widget/select",["sandbox","views/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/widget/select"],events:{click:"toggle","click li":"onSelect"},initialize:function(t){this.options=t.options||[],+t.width&&(this.width=+t.width+"px")},render:function(){var t={};t.options=this.options,t.width=this.width||!1,t.placeholder=i.get("select_category"),this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&t.options.length>6&&(this.$ul.slimScroll({height:"165px",alwaysVisible:!0}),this.$ul=this.$ul.closest(".slimScrollDiv").hide(),this.$ul.css({position:"absolute",width:"100%"}),this.$ul.find("ul").css({display:"",width:""}))},select:function(t,e){this.$span.html(e),this.$span.data("value",t),this.trigger("select",t,e)},toggle:function(){this.$ul.toggle()
},value:function(){return this.$span.data("value")},reset:function(){this.$ul&&this.$ul.hide(),this.options&&this.options.length&&(this.$span.html(this.options[0][1]),this.$span.data("value",this.options[0][0]))},onSelect:function(e){var i=t(e.currentTarget),s=i.data("value"),o=i.html();e.stopPropagation(),this.select(s,o),this.toggle()}})}),i("views/widget/select-album",["sandbox","views/widget/select","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/widget/select-album"],render:function(){var t={};t.options=this.options,t.width=this.width||!1,t.placeholder=i.get("select_category"),this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&(t.options.length>3&&(this.$ul.slimScroll({height:"150px",alwaysVisible:!0}),this.$ul=this.$ul.closest(".slimScrollDiv").hide(),this.$ul.css({position:"absolute",width:"100%"}),this.$ul.find("ul").css({display:"",width:""})),t.options[0]&&this.select(t.options[0][0],t.options[0][1]))},onSelect:function(e){var i=t(e.currentTarget),s=i.data("value"),o=i.find("p").html();e.stopPropagation(),this.select(s,o),this.toggle()}})}),i("views/postbox/photo-preview",["sandbox","app","views/base","views/widget/select-album","utils/ajax","utils/constants","utils/language"],function(t,e,i,s,o,a,n){return i.extend({templates:{div:joms.jst["html/postbox/photo-preview"],img:joms.jst["html/postbox/photo-item"]},events:{"click .joms-postbox-photo-remove":"onRemove"},render:function(){this.$el.html(this.templates.div()),this.$list=this.$("ul"),this.$form=this.$("div.joms-postbox-photo-form")},add:function(i){if(this.$list.append(this.templates.img({id:this.getFileId(i),src:e.legacyUrl+"/assets/photo-upload-placeholder.png"})),!this.select){var o=a.get("album"),r=n.get("privacy"),h=[],d={0:"public",10:"public",20:"site_members",30:"friends",40:"me"},l={0:"globe",10:"public",20:"users",30:"user",40:"lock"};if(o&&o.length){this.albummap={};for(var c,u,p=0;p<o.length;p++)c=o[p],u=""+c.permissions,this.albummap[""+c.id]=u,c=[c.id,c.name,r[d[u]||"0"],l[u||"0"]],h[+c["default"]?"unshift":"push"](c);this.select=new s({options:h});var m=t('<div class="joms-postbox-select-album joms-select">').insertAfter(this.$form);this.assign(m,this.select)}}},value:function(){var t,e;return this.select&&(t=""+this.select.value(),e=this.albummap[t]),{id:this.pics||[],album_id:t,privacy:e}},updateProgress:function(t){var e,i=this.getFileId(t),s=this.$list.find("#"+i).find(".joms-postbox-photo-progress");s&&s.length&&(e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.stop().animate({width:e+"%"}))},setImage:function(t,e){e||(e={});var i=this.$list.find("#"+this.getFileId(t)),s=a.get("juri.base")+e.thumbnail,o=e.id;i.find("img").attr("src",s).data("id",o),i.find("img").attr("style","visibility:visible"),i.find(".joms-postbox-photo-action").show(),i.addClass("joms-postbox-photo-loaded"),i.find(".joms-postbox-photo-progressbar").remove(),this.pics||(this.pics=[]),this.pics.push(""+o),this.trigger("update",this.pics.length)},removeFailed:function(){this.$list.find(".joms-postbox-photo-item").not(".joms-postbox-photo-loaded").remove(),this.trigger("update",this.pics&&this.pics.length||0)},onRemove:function(e){var i,s=t(e.target).closest("li"),o=s.find("img").data("id");s.remove(),this.pics=t.without(this.pics,""+o),i=this.pics.length,0>=i&&this.select.remove(),this.ajaxRemove([o]),this.trigger("update",i)},remove:function(){return this.pics&&this.pics.length&&this.ajaxRemove(this.pics),i.prototype.remove.apply(this,arguments)},ajaxRemove:function(e){var i={};i.option="community",i.no_html=1,i.task="azrul_ajax",i.func="system,ajaxDeleteTempImage",i[window.jax_token_var]=1,e&&e.length&&(i["arg2[]"]=e),t.ajax({url:window.jax_live_site,type:"post",dataType:"json",data:i})},getFileId:function(t){return"postbox-preview-"+t.id}})}),i("views/inputbox/photo",["sandbox","views/inputbox/status","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/inputbox/photo"],initialize:function(){var t,o,a,n;if(e.prototype.initialize.apply(this,arguments),this.hint={single:s.get("status.photo_hint")||"",multiple:s.get("status.photos_hint")||""},this.moods=i.get("moods"),t={},this.moods&&this.moods.length)for(n=0;n<this.moods.length;n++)a=this.moods[n].id,o=[a,this.moods[n].description],this.moods[n].custom&&(o[2]=this.moods[n].image),t[a]=o;this.moods=t},reset:function(){e.prototype.reset.apply(this,arguments),this.single()},single:function(){this.hint.current=this.hint.single,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},multiple:function(){this.hint.current=this.hint.multiple,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},updateAttachment:function(t){var e=[];return this.mood=t||t===!1?t:this.mood,this.mood&&this.moods[this.mood]&&e.push("undefined"!=typeof this.moods[this.mood][2]?'<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>":'<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>"),e.length?(this.$attachment.html(" &nbsp;&mdash; "+e.join(" and ")+"."),void this.$textarea.removeAttr("placeholder")):(this.$attachment.html(""),void this.$textarea.attr("placeholder",this.hint.current))},getTemplate:function(){var e=this.template({placeholder:this.hint.current=this.hint.single});return t(e)}})}),i("utils/uploader",["sandbox","app"],function(t,e){function i(t){if(this.queue=[],this.ready=!1,window.plupload)return this.ready=!0,void this.create(t);var i=this;$LAB.script(e.legacyUrl+"assets/multiupload_js/plupload.combined.js").wait(function(){i.ready=!0,i.create(t),i.execQueue()})}var s={runtimes:"html5,html4",url:"index.php"};return i.prototype.create=function(e){var i,o=this.$button=e.browse_button,a=!1;"string"==typeof o?this.$button=t(document.getElementById(o)):(a=o.attr("id"))?this.$button=t(document.getElementById(a)):(e.browse_button=a=t.uniqueId("uploader_"),o.attr("id",a)),"string"!=typeof e.container&&(i=t(e.container),(a=i.attr("id"))?e.container=a:(e.container=a=t.uniqueId("uploader_parent_"),i.attr("id",a))),this.onProgress=e.onProgress||t.noop,this.onAdded=e.onAdded||t.noop,e=t.extend({},s,e||{}),this.uploader=new plupload.Uploader(e)},i.prototype.init=function(){if(!this.ready)return void this.queue.push(["init",this,arguments]);try{this.uploader.init()}catch(t){}this.uploader.bind("FilesAdded",this.onAdded),this.uploader.bind("Error",this.onError),this.uploader.bind("BeforeUpload",this.onBeforeUpload),this.uploader.bind("UploadProgress",this.onProgress),this.uploader.bind("FileUploaded",this.onUploaded),this.uploader.bind("UploadComplete",this.onComplete)},i.prototype.open=function(){return this.ready?void this.$button.click():void this.queue.push(["open",this,arguments])},i.prototype.reset=function(){return this.ready?void 0:void this.queue.push(["reset",this,arguments])},i.prototype.remove=function(){return this.ready?void 0:void this.queue.push(["remove",this,arguments])},i.prototype.params=function(t){this.uploader.settings.multipart_params=t},i.prototype.upload=function(){return this.ready?void 0:void this.queue.push(["upload",this,arguments])},i.prototype.execQueue=function(){for(var t;this.queue.length;)t=this.queue.shift(),this[t[0]].apply(t[1],t[2])},i.prototype.onAdded=t.noop,i.prototype.onError=t.noop,i.prototype.onBeforeUpload=t.noop,i.prototype.onProgress=t.noop,i.prototype.onUploaded=t.noop,i.prototype.onComplete=t.noop,i}),i("views/postbox/photo",["sandbox","app","views/postbox/default","views/postbox/photo-preview","views/inputbox/photo","views/dropdown/mood","views/widget/select","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o,a,n,r,h,d){return i.extend({subviews:{mood:a},template:joms.jst["html/postbox/photo"],events:t.extend({},i.prototype.events,{"click .joms-postbox-photo-upload":"onPhotoAdd","click li[data-tab=upload]":"onPhotoAdd"}),initialize:function(){this.enableMood=+r.get("conf.enablemood"),this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$initial=this.$(".joms-postbox-inner-panel"),this.$main=this.$(".joms-postbox-photo"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$preview=this.$(".joms-postbox-preview"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.enableMood||this.$tabmood.remove(),this.$uploader=this.$("#joms-postbox-photo-upload"),this.$uploaderParent=this.$uploader.parent(),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var e="index.php?option=com_community&view=photos&task=ajaxPreview",s=r.get("settings")||{};s.isGroup&&(e+="&no_html=1&tmpl=component&groupid="+(r.get("groupid")||"")),t.ie&&(this.$uploader.appendTo(document.body),this.$uploader.show());var a={container:"joms-postbox-photo-upload",browse_button:"joms-postbox-photo-upload-btn",url:e,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}]};return t.mobile||(a.resize={width:2100,height:2100,quality:90}),this.uploader=new d(a),this.uploader.onAdded=t.bind(this.onPhotoAdded,this),this.uploader.onError=t.bind(this.onPhotoError,this),this.uploader.onProgress=t.bind(this.onPhotoProgress,this),this.uploader.onUploaded=t.bind(this.onPhotoUploaded,this),this.uploader.init(),t.ie&&(this.$uploader.hide(),this.$uploader.appendTo(this.$uploaderParent)),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),t.ie&&t.ieVersion<10&&this.ieUploadButtonFix(!0),this.inputbox&&this.inputbox.single(),this.preview&&this.preview.remove(),this.preview=!1,this.showMoreButton(),i.prototype.showInitialState.apply(this)},showMainState:function(){i.prototype.showMainState.apply(this),this.$action.hide(),this.$initial.hide(),this.$main.show(),this.$save.show(),t.ie&&t.ieVersion<10&&this.ieUploadButtonFix(),e.postbox&&e.postbox.value&&e.postbox.value.length&&(this.inputbox.set(e.postbox.value[0]),e.postbox.value=!1)},showMoreButton:function(){this.$tabupload.show(),this.$tabupload.css({visibility:""})},hideMoreButton:function(){this.subviews.mood?this.$tabupload.hide():this.$tabupload.css({visibility:"hidden"})},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.preview&&this.preview.remove(),this.preview=!1},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var e;for(var s in this.subflags)(e=this.subviews[s].value())&&(this.data.attachment[s]=e);return this.preview&&t.extend(this.data.attachment,this.preview.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0),e=t[1]||{};return!e.id&&e.id.length?"No image selected.":void 0},onPhotoAdd:function(){if(!this.uploading){var e=r.get("conf")||{},i=+e.limitphoto,s=+e.uploadedphoto;return this.preview&&this.preview.pics&&this.preview.pics.length>=8?void window.alert(h.get("photo.batch_notice")):(this.preview&&this.preview.pics&&this.preview.pics.length&&(s+=this.preview.pics.length),s>=i?void window.alert(h.get("photo.upload_limit_exceeded")||"You have reached the upload limit."):void(window.opera||t.ie&&10===t.ieVersion?this.$("#joms-postbox-photo-upload").find("input[type=file]").click():this.uploader.open()))}},onPhotoAdded:function(e,i){if(!this.uploading&&i&&i.length){var o=0;this.preview&&this.preview.pics&&this.preview.pics.length&&(o=this.preview.pics.length),o+i.length>8&&(o=o+i.length-8,i.splice(0-o,o),e.splice(0-o,o));var a=r.get("conf")||{},n=+a.limitphoto,h=+a.uploadedphoto;this.preview&&this.preview.pics&&this.preview.pics.length&&(h+=this.preview.pics.length);var d;h+i.length>n&&(d=h+i.length-n,i.splice(0-d,d),e.splice(0-d,d));var l;this.preview||(l=t("<div>").appendTo(this.$preview),this.preview=new s,this.assign(l,this.preview),this.listenTo(this.preview,"update",function(t){return!t||0>=t?(this.showInitialState(),this.inputbox.single(),void(this.uploading=0)):(t>=8?this.hideMoreButton():this.showMoreButton(),void this.inputbox[t>1?"multiple":"single"]())})),this.showMainState();for(var c=0;c<i.length;c++)this.preview.add(i[c]);this.uploading=i.length,this.$action.hide(),e.start(),e.refresh()}},onPhotoError:function(t,e){+e.code===+plupload.FILE_EXTENSION_ERROR&&window.alert("Selected file type is not permitted.")},onPhotoProgress:function(t,e){this.preview.updateProgress(e)},onPhotoUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(o){}return s||(s={}),s.thumbnail?(this.uploading--,this.uploading<=0&&this.$action.show(),void(this.preview&&this.preview.setImage(e,s))):(t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.uploading=0,this.$action.show(),void(this.preview&&this.preview.removeFailed()))},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},getTemplate:function(){var e=this.template({juri:r.get("juri"),language:{postbox:h.get("postbox")||{},status:h.get("status")||{},photo:h.get("photo")||{}}});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},r.get("postbox.attachment")||{},{type:"photo"}),this.staticAttachment)},ieUploadButtonFix:function(t){this.ieUploadButtonFix.init||(this.ieUploadButtonFix.init=!0,this.$uploader.css({display:"block",position:"absolute",opacity:0,width:"",height:""}).children("button,form").css({display:"block",position:"absolute",width:"",height:"",top:0,right:0,bottom:0,left:0}).children("input").css({cursor:"pointer",height:"100%"})),t?(this.$uploader.appendTo(this.$uploaderParent),this.$uploader.css({top:12,right:12,bottom:12,left:12}).children("form").css({width:"100%",height:"100%"})):(this.$uploader.appendTo(this.$tabupload),this.$uploader.css({top:0,right:0,bottom:0,left:0}))}})}),i("views/inputbox/videourl",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/videourl"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},onKeydown:function(e){e&&13===e.keyCode&&e.preventDefault();var i=this;t.defer(function(){i.updateInput(e)})},getTemplate:function(){var e=i.get("video.link_hint")||"",s=this.template({placeholder:e});return t(s)}})}),i("views/postbox/fetcher-video",["sandbox","views/base","views/widget/select","utils/ajax","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/postbox/fetcher-video"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur"},initialize:function(){var t=o.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||"",t=o.get("video"),this.categoryLabel=t.category_label},fetch:function(e){var i=/^(|.*\s)(https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,4}(:\d+)?(\/.*)?(\s.*|)$/i,o=e.match(i);if(!this.fetching&&o){this.id=!1,this.url=e,this.fetching=!0,this.fetched=!1,this.trigger("fetch:start");var a=this;s({fn:"videos,ajaxLinkVideoPreview",data:[e],complete:function(){a.fetching=!1,a.trigger("fetch:done")},success:t.bind(this.render,this)})}},render:function(t){if(t=this.parseResponse(t),!t)return void this.trigger("fetch:failed");var e=t&&t.video,s=this.sortCategories(t&&t.category||[]);if(!e||!e.id)return void this.trigger("fetch:failed",t);this.video_id=e.id,this.fetched=!0;var a={title:e.title||"",titlePlaceholder:this.titlePlaceholder,description:e.description||"",descPlaceholder:this.descPlaceholder,image:e.thumb||!1,lang:{cancel:(o.get("cancel")||"").toLowerCase()}};this.select&&this.select.remove(),this.$el.html(this.template(a)),this.$image=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.$category=this.$(".joms-fetched-category");for(var n=[],r=0;r<s.length;r++)n.push([s[r].id,this.categoryLabel+": "+s[r].name]);return this.select=new i({options:n}),this.assign(this.$category,this.select),this},change:function(e){var i=t(e),s=i.prev("span"),o=i.val().replace(/^\s+|\s+$/g,"");o||(o=i.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder),i.hide(),s.text(o).show()},remove:function(){e.prototype.remove.apply(this),this.trigger("remove")},value:function(){return this.fetching?[]:[this.video_id,this.url,this.$image&&this.$image.attr("src"),this.$title&&this.escapeValue(this.$title.val()),this.$description&&this.escapeValue(this.$description.val()),this.select&&this.select.value()]},onClose:function(){this.remove()},onFocus:function(e){var i=t(e.currentTarget),s=i.next("input,textarea");i.hide(),s.show(),setTimeout(function(){s[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){var e;if(t&&t.length)for(var i=0;i<t.length;i++){if("__throwError"===t[i][1]){e={msg:t[i][3]};break}if("__callback"===t[i][1]){e=t[i][3][0];break}}return e},sortCategories:function(t,e,i){if(!t||!t.length)return[];e||(e=0),i||(i="");for(var s,o,a=[],n=0;n<t.length;n++)+t[n].parent===e&&(s=+t[n].id,o=i+t[n].name,a.push({id:s,name:o}),a=a.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return a},escapeValue:function(t){return"string"!=typeof t?t:t.replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"')}})}),i("views/inputbox/video",["sandbox","views/inputbox/status","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/video"],getTemplate:function(){var e=i.get("status.video_hint")||"",s=this.template({placeholder:e});return t(s)}})}),i("views/postbox/video",["sandbox","app","views/postbox/default","views/inputbox/videourl","views/postbox/fetcher-video","views/inputbox/video","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","views/widget/select","utils/ajax","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o,a,n,r,h,d,l,c,u,p){return i.extend({subviews:{mood:n,location:r,privacy:h},template:joms.jst["html/postbox/video"],events:t.extend({},i.prototype.events,{"click [data-action=share]":"onVideoUrl","click [data-action=upload]":"onVideoUpload"}),initialize:function(){this.enableUpload=+c.get("conf.enablevideosupload"),this.enableMood=+c.get("conf.enablemood"),this.enableLocation=+c.get("conf.enablevideosmap"),this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),this.enableLocation||(this.subviews=t.omit(this.subviews,"location"));var e=c.get("settings")||{};(this.inheritPrivacy=e.isGroup||e.isEvent||!e.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),this.language={postbox:u.get("postbox"),status:u.get("status"),video:u.get("video")},i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$initial=this.$(".joms-initial-panel"),this.$main=this.$(".joms-postbox-video"),this.$stateurl=this.$(".joms-postbox-video-state-url"),this.$stateupload=this.$(".joms-postbox-video-state-upload"),this.$url=this.$stateurl.find(".joms-postbox-url"),this.$fetcher=this.$stateurl.find(".joms-postbox-fetched"),this.$file=this.$stateupload.find(".joms-postbox-url"),this.$fileprogress=this.$stateupload.find(".joms-postbox-photo-progress"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.url=new s,this.assign(this.$url,this.url),this.listenTo(this.url,"focus",this.onUrlFocus),this.listenTo(this.url,"keydown",this.onUrlUpdate),this.listenTo(this.url,"blur",this.onUrlUpdate),this.inputbox=new a({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var e,o;this.inheritPrivacy||(o=c.get("settings")||{},o.isProfile&&o.isMyProfile&&(e=c.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{defaultPrivacy:e||"public"}));var n=+c.get("conf.maxvideouploadsize")||0;return n&&(n+="mb"),this.uploader=new p({container:"joms-postbox-video-upload",browse_button:"joms-postbox-video-upload-btn",url:"index.php?option=com_community&view=videos&task=uploadvideo",multi_selection:!1,filters:[{title:"Video files",extensions:"3g2,3gp,asf,asx,avi,flv,mov,mp4,mpg,rm,swf,vob,wmv,m4v"}],max_file_size:n}),this.uploader.onAdded=t.bind(this.onVideoAdded,this),this.uploader.onError=t.bind(this.onVideoError,this),this.uploader.onBeforeUpload=t.bind(this.onVideoBeforeUpload,this),this.uploader.onProgress=t.bind(this.onVideoProgress,this),this.uploader.onUploaded=t.bind(this.onVideoUploaded,this),this.uploader.init(),this},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.enableUpload?(this.$main.hide(),this.$initial.show()):this.showUrlState(),this.trigger("show:initial")},showMainState:function(t){t?this.showUploadState():this.showUrlState(),this.$tabs.show(),this.$action.show(),this.trigger("show:main")},showUrlState:function(){this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.status.video_hint),this.$save.html(this.language.postbox.post_button),this.$stateupload.hide(),this.$stateurl.show(),this.$initial.hide(),this.$main.show(),this.upload=!1,e.postbox&&e.postbox.value&&e.postbox.value.length&&(this.inputbox.set(e.postbox.value[0]),e.postbox.value=!1)},showUploadState:function(){var t,i,s;if(!this.uploadcat){for(t=this.sortCategories(c.get("videoCategories")||[]),i=[],s=0;s<t.length;s++)i.push([t[s].id,this.language.video.category_label+": "+t[s].name]);this.uploadcat=new d({options:i}),this.$uploadcat=this.$stateupload.find(".joms-fetched-category"),this.assign(this.$uploadcat,this.uploadcat)}this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.video.upload_hint),this.$save.html(this.language.postbox.upload_button),this.$stateurl.hide(),this.$stateupload.show(),this.$initial.hide(),this.$main.show(),this.$save.show(),this.upload=!0,e.postbox&&e.postbox.value&&e.postbox.value.length&&(this.inputbox.set(e.postbox.value[0]),e.postbox.value=!1)},reset:function(){i.prototype.reset.apply(this),this.url&&this.url.reset(),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.upload?this.status&&"success"===this.status.status&&(this.data.attachment.fetch=[this.status.videoid]):this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0),e=t[1]||{},i=e.fetch;if(this.upload){if(!this.uploadcat||!this.uploadcat.value())return u.get("video.category_notice")}else{if(!i||!i.length)return u.get("video.url_notice");if(!i[5])return u.get("video.category_notice")}},onPost:function(){if(!this.saving){var e=this.validate();if(e)return void window.alert(e);if(this.saving=!0,this.$loading.show(),this.upload===!0)return void this.uploader.uploader.start();var i=this;l({fn:"system,ajaxStreamAdd",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t)},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1)},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},onUrlFocus:function(){this.enableUpload||this.showMainState()},onUrlUpdate:function(e,i){var s;if(e&&(e=e.replace(/^\s+|\s+$/g,"")),32===i||13===i){if(this.fetcher&&(this.fetcher.fetching||this.fetcher.fetched))return;delete this.data.attachment.fetch,s=t("<div>").appendTo(this.$fetcher),this.fetcher&&this.fetcher.remove(),this.fetcher=new o,this.fetcher.setElement(s),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:failed",this.onFetchFailed),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(e)}},onInputFocus:function(){this.enableUpload||this.showMainState()},onFetchStart:function(){this.saving=!0,this.$loading.show(),this.$save.hide()},onFetchFailed:function(t){this.fetcher&&this.fetcher.remove(),this.saving=!1,this.$loading.hide(),this.$save.hide();var e=t&&t.msg||"Undefined error.";window.alert(e)},onFetchDone:function(){this.saving=!1,this.$loading.hide(),this.fetcher&&this.fetcher.fetched&&this.$save.show()},onFetchRemove:function(){this.fetcher=!1,this.$save.hide()},onVideoUrl:function(){this.showMainState()},onVideoUpload:function(){var t=c.get("conf")||{},e=+t.limitvideo,i=+t.uploadedvideo;return i>=e?void window.alert(u.get("video.upload_limit_exceeded")||"You have reached the upload limit."):(this.uploader.uploader.splice(),void this.uploader.open())},onVideoAdded:function(t,e){if(e&&e.length){for(var i=e[0],s="<b>"+i.name+"</b>",o=i.size||0,a="Bytes",n=["KB","MB","GB"];o>=1e3&&n.length;)a=n.shift(),o=Math.ceil(o/1e3);o&&(s+=" ("+o+" "+a+")"),this.$file.html(s),this.$fileprogress.css({width:0}),this.showMainState("upload")}},onVideoError:function(t,e){var i;+e.code===+plupload.FILE_SIZE_ERROR?(i=+c.get("conf.maxvideouploadsize")||0,window.alert("Maximum file size for video upload is "+i+" MB.")):+e.code===+plupload.FILE_EXTENSION_ERROR&&window.alert("Selected file type is not permitted.")},onVideoBeforeUpload:function(){var t={description:this.inputbox.value()};this.subflags.privacy&&(t.permissions=this.subviews.privacy.value());var e=this.subflags.location&&this.subviews.location.value();e&&e.length&&(t.location=e),this.uploadcat&&(t.category_id=this.uploadcat&&this.uploadcat.value()),this.uploader.params(t)},onVideoProgress:function(t,e){var i=Math.min(100,Math.round(100*e.loaded/e.size));this.$fileprogress.animate({width:i+"%"})},onVideoUploaded:function(t,e,i){var s,o;try{s=JSON.parse(i.response)}catch(a){}this.status=s||{},o=this,setTimeout(function(){if(o.$loading.hide(),o.saving=!1,o.showInitialState(),"success"!==o.status.status)window.alert(o.status.message||"Undefined error.");else{var t=c.get("conf")||{};++t.uploadedvideo,window.alert(o.status.processing_str)}},1e3)},getTemplate:function(){var e=this.template({juri:c.get("juri"),enable_upload:this.enableUpload,video_maxsize:c.get("conf.maxvideouploadsize"),language:{postbox:u.get("postbox")||{},status:u.get("status")||{},video:u.get("video")||{}}});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},c.get("postbox.attachment")||{},{type:"video"}),this.staticAttachment)},sortCategories:function(t,e,i){if(!t||!t.length)return[];e||(e=0),i||(i="");for(var s,o,a=[],n=0;n<t.length;n++)+t[n].parent===e&&(s=+t[n].id,o=i+t[n].name,a.push({id:s,name:o}),a=a.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return a}})}),i("views/inputbox/eventtitle",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/eventtitle"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},getTemplate:function(){var e=i.get("event.title_hint")||"",s=this.template({placeholder:e});return t(s)}})}),i("views/inputbox/eventdesc",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/eventdesc"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},getTemplate:function(){var e=i.get("status.event_hint")||"",s=this.template({placeholder:e});return t(s)}})}),i("views/dropdown/event",["sandbox","views/dropdown/base","views/widget/select","utils/constants","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/dropdown/event"],events:{"click .joms-postbox-done":"onSave"},initialize:function(){e.prototype.initialize.apply(this);var t=s.get("eventCategories")||[],o=[];if(this.categoriesMap={},t&&t.length)for(var a=0,n=t[a].id,r=t[a].name;a<t.length;a++)n=t[a].id,r=t[a].name,this.categoriesMap[n]=r,o.push([n,r]);this.category=new i({options:o})},render:function(){var e,i=this.getTemplate(),a=+s.get("conf.eventshowampm"),n=+s.get("conf.firstday"),r=a?"h:i A":"H:i",h={};for(h.monthsFull=[o.get("datepicker.january"),o.get("datepicker.february"),o.get("datepicker.march"),o.get("datepicker.april"),o.get("datepicker.may"),o.get("datepicker.june"),o.get("datepicker.july"),o.get("datepicker.august"),o.get("datepicker.september"),o.get("datepicker.october"),o.get("datepicker.november"),o.get("datepicker.december")],h.monthsShort=[],e=0;e<h.monthsFull.length;e++)h.monthsShort[e]=h.monthsFull[e].substr(0,3);for(h.weekdaysFull=[o.get("datepicker.sunday"),o.get("datepicker.monday"),o.get("datepicker.tuesday"),o.get("datepicker.wednesday"),o.get("datepicker.thursday"),o.get("datepicker.friday"),o.get("datepicker.saturday")],h.weekdaysShort=[],e=0;e<h.weekdaysFull.length;e++)h.weekdaysShort[e]=h.weekdaysFull[e].substr(0,3);return h.today=o.get("datepicker.today"),h.clear=o.get("datepicker.clear"),h.firstDay=n,this.$el.replaceWith(i),this.setElement(i),this.$category=this.$(".joms-event-category"),this.$location=this.$("[name=location]").val(""),this.$startdate=this.$(".joms-pickadate-startdate").pickadate(t.extend({},h,{min:new Date,format:"d mmmm yyyy",klass:{frame:"picker__frame startDate"}})),this.$starttime=this.$(".joms-pickadate-starttime").pickatime({interval:15,format:r,formatLabel:r,klass:{frame:"picker__frame startTime"}}),this.$enddate=this.$(".joms-pickadate-enddate").pickadate(t.extend({},h,{format:"d mmmm yyyy",klass:{frame:"picker__frame endDate"}})),this.$endtime=this.$(".joms-pickadate-endtime").pickatime({interval:15,format:r,formatLabel:r,klass:{frame:"picker__frame endTime"}}),this.$done=this.$(".joms-event-done"),this.assign(this.$category,this.category),this.startdate=this.$startdate.pickadate("picker"),this.starttime=this.$starttime.pickatime("picker"),this.enddate=this.$enddate.pickadate("picker"),this.endtime=this.$endtime.pickatime("picker"),this.startdate.on({set:t.bind(this.onSetStartDate,this)}),this.starttime.on({set:t.bind(this.onSetStartTime,this)}),this.enddate.on({set:t.bind(this.onSetEndDate,this)}),this.endtime.on({set:t.bind(this.onSetEndTime,this)}),this},show:function(){return this.category&&this.category.reset(),e.prototype.show.apply(this,arguments)},value:function(){return this.data},reset:function(){this.$location.val(""),this.$startdate.val(""),this.$starttime.val(""),this.$enddate.val(""),this.$endtime.val("")},onSetStartDate:function(t){var e=t.select;this.enddate.set({min:new Date(e)},{muted:!0}),this._checkTime()},onSetEndDate:function(t){var e=t.select;this.startdate.set({max:new Date(e)},{muted:!0}),this._checkTime()},onSetStartTime:function(){this._checkTime("start")},onSetEndTime:function(){this._checkTime("end")},onSave:function(){var t,e=this.category.value(),i=this.startdate.get("select"),s=this.starttime.get("select"),o=this.enddate.get("select"),a=this.endtime.get("select");
return i&&(i=[this.startdate.get("select","yyyy-mm-dd"),this.startdate.get("value")]),s&&(s=[this.starttime.get("select","HH:i"),this.starttime.get("value")]),o&&(o=[this.enddate.get("select","yyyy-mm-dd"),this.enddate.get("value")]),a&&(a=[this.endtime.get("select","HH:i"),this.endtime.get("value")]),this.data={category:e?[e,this.categoriesMap[e]]:!1,location:this.$location.val(),startdate:i,starttime:s,enddate:o,endtime:a,allday:!1},this.data.category?this.data.location?this.data.startdate?this.data.starttime?this.data.enddate?this.data.endtime||(t="End time is not selected."):t="End date is not selected.":t="Start time is not selected.":t="Start date is not selected.":t="Location is not selected.":t="Category is not selected.",t?void window.alert(t):(this.trigger("select",this.data),void this.hide())},getTemplate:function(){var e=this.template({language:{event:o.get("event")||{}}});return t(e).hide()},_checkTime:function(){var t,e,i=this.startdate.get("select"),s=this.enddate.get("select");i&&s&&(s.year<=i.year&&s.month<=i.month&&s.date<=i.date?(t=this.starttime.get("select"),e=this.endtime.get("select"),t?(this.endtime.set({min:[t.hour,t.mins]},{muted:!0}),e&&e.time<t.time&&this.endtime.set({select:[t.hour,t.mins]},{muted:!0})):this.endtime.set({min:!1},{muted:!0}),e?(this.starttime.set({max:[e.hour,e.mins]},{muted:!0}),t&&t.time>e.time&&this.starttime.set({select:[e.hour,e.mins]},{muted:!0})):this.starttime.set({max:!1},{muted:!0})):(this.starttime.set({max:!1},{muted:!0}),this.endtime.set({min:!1},{muted:!0})))}})}),i("utils/format",["sandbox"],function(t){function e(e,i,s){if(!t.isString(e))return e;if(!t.isNumber(i)||e.length>=i)return e;i-=e.length;for(var o=0;i>o;o++)e=(s||" ")+e;return e}return{pad:e}}),i("views/postbox/event",["sandbox","views/postbox/default","views/inputbox/eventtitle","views/inputbox/eventdesc","views/dropdown/event","utils/constants","utils/format","utils/language"],function(t,e,i,s,o,a,n,r){return e.extend({subviews:{event:o},template:joms.jst["html/postbox/event"],events:t.extend({},e.prototype.events,{"click .joms-postbox-event-title":"onFocus"}),render:function(){return e.prototype.render.apply(this),this.$title=this.$(".joms-postbox-title"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$category=this.$(".joms-postbox-event-label-category"),this.$location=this.$(".joms-postbox-event-label-location"),this.$date=this.$(".joms-postbox-event-label-date"),this.title=new i,this.assign(this.$title,this.title),this.listenTo(this.title,"focus",this.onInputFocus),this.listenTo(this.title,"keydown",this.onNewInputUpdate),this.inputbox=new s({charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onNewInputUpdate),this},reset:function(){e.prototype.reset.apply(this),this.title&&this.title.reset(),this.inputbox&&this.inputbox.reset(),this.$category&&this.onEventSelect({})},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={};var i;for(var s in this.subflags)(i=this.subviews[s].value())&&(this.data.attachment[s]=i);var o=(this._data.starttime||"").split(":"),a=(this._data.endtime||"").split(":");return t.extend(this.data.attachment,{title:this.title.value(),catid:this._data.category&&this._data.category[0]||null,location:this._data.location,startdate:this._data.startdate,enddate:this._data.enddate,allday:!1,"starttime-hour":o[0]||null,"starttime-min":o[1]||null,"endtime-hour":a[0]||null,"endtime-min":a[1]||null}),e.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0),e=t[0];return e?void 0:"Event description cannot be empty."},onInputFocus:function(){this.showMainState()},onInputUpdate:t.debounce(function(){var t=this.value(!0),e=t[0],i=t[1],s=!0;this.trim(i.title)&&this.trim(e)&&i.catid&&i.location&&i.startdate&&i.enddate&&(i["starttime-hour"]||i["starttime-min"])?i["endtime-hour"]||i["endtime-min"]||(s=!1):s=!1,this.$save[s?"show":"hide"]()},300),onNewInputUpdate:t.debounce(function(){var t=this.value(!0),e=t[0],i=t[1],s=!0;this.trim(i.title)&&this.trim(e)&&i.catid&&i.location&&i.startdate&&i.enddate&&(i["starttime-hour"]||i["starttime-min"])?i["endtime-hour"]||i["endtime-min"]||(s=!1):s=!1,this.$save[s?"show":"hide"]()},300),onPost:function(){var t,i=a.get("conf")||{},s=+i.limitevent,o=+i.createdevent;return o>=s?(t=r.get("event.create_limit_exceeded")||"You have reached the event creation limit.",t=t.replace("%1$s",s),void window.alert(t)):void e.prototype.onPost.apply(this,arguments)},onPostSuccess:function(){e.prototype.onPostSuccess.apply(this,arguments);var t=a.get("conf")||{};t.createdevent=+t.createdevent+1},onEventSelect:function(t){t.category?(this.$category.find(".joms-input-text").html(t.category&&t.category[1]),this.$category.show()):this.$category.hide(),t.location?(this.$location.find(".joms-input-text").html(t.location),this.$location.show()):this.$location.hide();var e=[];t.startdate&&t.enddate?(e.push(t.startdate[1]+" "+t.starttime[1]),e.push(t.enddate[1]+" "+t.endtime[1]),this.$date.find(".joms-input-text").html(e.join(" &mdash; ")),this.$date.show()):this.$date.hide(),t.startdate&&(t.startdate=t.startdate[0]),t.starttime&&(t.starttime=t.starttime[0]),t.enddate&&(t.enddate=t.enddate[0]),t.endtime&&(t.endtime=t.endtime[0]),this._data=t,this.onInputUpdate()},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},parseResponse:function(e){var i,s,o="activity-stream-container";if(e&&e.length)for(var a=0;a<e.length;a++)e[a][1]===o&&(i=e[a][3]),"al"===e[a][0]&&(s=e[a][3],window.alert(t.isArray(s)?s.join(". "):s)),"__throwError"===e[a][1]&&(s=e[a][3],window.alert(t.isArray(s)?s.join(". "):s));return i},getTemplate:function(){var e=r.get("event")||{};e.event_detail&&(e.event_detail=e.event_detail.toLowerCase());var i=this.template({juri:a.get("juri"),language:{postbox:r.get("postbox")||{},event:e}});return t(i).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},a.get("postbox.attachment")||{},{type:"event"}),this.staticAttachment)},trim:function(t){return(t||"").replace(/^\s+|\s+$/g,"")}})}),i("views/postbox/custom",["sandbox","views/postbox/default","views/dropdown/privacy","utils/ajax","utils/constants","utils/language"],function(t,e,i,s,o,a){return e.extend({subviews:{privacy:i},template:joms.jst["html/postbox/custom"],events:t.extend({},e.prototype.events,{"click .joms-postbox-predefined-message":"onCustomPredefined","click .joms-postbox-custom-message":"onCustomCustom","keyup [name=custom]":"onTextareaUpdate"}),initialize:function(){var i=o.get("settings")||{};(this.inheritPrivacy=i.isGroup||i.isEvent||!i.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),e.prototype.initialize.apply(this),this.attachment={type:"custom"},t.extend(this.attachment,o.get("postbox.attachment")||{})},render:function(){return e.prototype.render.apply(this),this.$initial=this.$el.children(".joms-postbox-inner-panel"),this.$main=this.$el.children(".joms-postbox-custom"),this.$statepredefined=this.$(".joms-postbox-custom-state-predefined"),this.$statecustom=this.$(".joms-postbox-custom-state-custom"),this.$predefined=this.$("[name=predefined]"),this.$custom=this.$("[name=custom]"),this.$divs=this.$(".joms-postbox-dropdown").hide(),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.inheritPrivacy||(this.initSubview("privacy",{privacylist:["public","site_members"]}),this.subviews.privacy.setPrivacy("public")),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),e.prototype.showInitialState.apply(this)},showMainState:function(t){e.prototype.showMainState.apply(this),t?this.showPredefinedState():this.showCustomState()},showPredefinedState:function(){this.$initial.hide(),this.$statepredefined.show(),this.$statecustom.hide(),this.$main.show(),this.$save.show(),this.predefined=!0},showCustomState:function(){this.$initial.hide(),this.$statepredefined.hide(),this.$statecustom.show(),this.$main.show(),this.predefined=!1},reset:function(){e.prototype.reset.apply(this),this.$predefined&&this.$predefined.val(this.$predefined.find("option:first").val()),this.$custom&&this.$custom.val("")},value:function(){var t=[];return this.predefined?(t.push(this.$predefined.val()),t.push(this.$predefined.find("option:selected").text())):(t.push("system.message"),t.push(this.$custom.val().replace(/\n/g,"\\n"))),"privacy"in this.subflags&&t.push(this.subviews.privacy.value()),t},validate:function(){var t,e=this.value();return this.predefined?e[0]||(t="Predefined message cannot be empty."):e[1]||(t="Custom message cannot be empty."),t},onTextareaUpdate:function(){var t=this.$custom.val();t=t.replace(/^\s+|\s+$/g,""),this.$save[t?"show":"hide"]()},onCustomPredefined:function(){this.showMainState("predefined")},onCustomCustom:function(){this.showMainState()},onPost:function(){if(!this.saving){var e=this.validate();if(e)return void window.alert(e);this.saving=!0,this.$loading.show();var i=this;s({fn:"activities,ajaxAddPredefined",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},getTemplate:function(){var e=o.get("customActivities")||{},i=[];for(var s in e)i.push([s,e[s]]);var n=this.template({juri:o.get("juri"),messages:i,language:{postbox:a.get("postbox"),custom:a.get("custom")}});return t(n).hide()}})}),i("views/postbox/layout",["sandbox","views/base","views/postbox/status","views/postbox/photo","views/postbox/video","views/postbox/event","views/postbox/custom","utils/constants"],function(t,e,i,s,o,a,n,r){return e.extend({subflags:{},subviews:{status:i,photo:s,video:o,event:a,custom:n},events:{"click .joms-postbox-tab-root li":"onChangeTab"},initialize:function(){this.listenTo(t,"postbox:photo",this.onOpenPhotoTab),this.listenTo(t,"postbox:video",this.onOpenVideoTab)},render:function(){var e=r.get("settings")||{},i=r.get("conf")||{};e.isAdmin&&i.enablecustoms||(this.subviews=t.omit(this.subviews,"custom")),e.isProfile&&!e.isMyProfile&&(this.subviews=t.pick(this.subviews,"status")),e.isEvent&&(this.subviews=t.omit(this.subviews,"photo","video","event")),(e.isProfile||e.isGroup)&&(i.enablephotos||(this.subviews=t.omit(this.subviews,"photo")),i.enablevideos||(this.subviews=t.omit(this.subviews,"video")),i.enableevents||(this.subviews=t.omit(this.subviews,"event"))),this.subkeys=t.keys(this.subviews),this.$subviews=this.$(".joms-postbox-tabs"),this.$tab=this.$(".joms-postbox-tab-root").hide();var s=this;this.$tab.find("li").each(function(){var e=t(this),i=e.data("tab");s.subkeys.indexOf(i)<0&&e.remove()}),this.subkeys&&this.subkeys.length&&this.changeTab(this.subkeys[0])},show:function(){this.$el[t.isMobile?"show":"fadeIn"]()},changeTab:function(e){if(this.subviews[e]){var i=this.$tab.find("li[data-tab="+e+"]");i&&i.length&&(i.hasClass("active")||i.addClass("active"),i.siblings(".active").removeClass("active")),this.subflags[e]||this.initSubview(e);for(var s in this.subflags)s!==e&&this.subviews[s].hide();this.subviews[e].show(),t.trigger("postbox:tab:change",e)}},onChangeTab:function(e){this.changeTab(t(e.currentTarget).data("tab"))},onOpenPhotoTab:function(){this.changeTab("photo")},onOpenVideoTab:function(){this.changeTab("video")},onShowInitialState:function(){this.subkeys.length>1&&this.$tab.show()},onShowMainState:function(){this.$tab.hide()},initSubview:function(t){this.subflags[t]||(this.subviews[t]=new this.subviews[t]({single:this.subkeys.length<=1}),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"show:initial",this.onShowInitialState),this.listenTo(this.subviews[t],"show:main",this.onShowMainState),this.subflags[t]=!0)},getSubviewElement:function(){var e=t("<div>").hide().appendTo(this.$subviews);return e}})}),i("views/stream/filterbar",["sandbox","views/base"],function(t,e){return e.extend({render:function(){this.$btn=t(".joms-activity-filter-action"),this.$list=t(".joms-activity-filter-dropdown"),this.$btn.on("click",t.bind(this.toggle,this)),this.$list.on("click","li",t.bind(this.select,this)),this.listenTo(t,"click",this.onDocumentClick)},toggle:function(){var t="none"===this.$list[0].style.display;t?this.expand():this.collapse()},expand:function(){this.$list.show()},collapse:function(){this.$list.hide()},select:function(e){var i=t(e.currentTarget),s=i.data("url")||"/";this.toggle(),window.location=s},onDocumentClick:function(t){t.closest(".joms-activity-filter").length||this.collapse()}})}),i("views/stream/item",["sandbox","views/base","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o){return e.extend({el:"#activity-stream-container",events:{"click .dropdown-menu a[data-action=edit]":"onEditStream","click .dropdown-menu a[data-action=remove-tag]":"onRemoveStreamTag","click [data-type=stream-editor] [data-action=cancel]":"onEditStreamCancel","click [data-type=stream-editor] [data-action=save]":"onEditStreamSave","click [data-type=stream-action] [data-action=comment]":"onCommentStreamAdd","click [data-type=stream-comments] [data-action=reply]":"onCommentStreamAdd","click [data-type=stream-newcomment] [data-action=attach]":"onCommentStreamAddAttach","click [data-type=stream-newcomment] [data-action=remove-attach]":"onCommentStreamAddRemoveAttach","click [data-type=stream-newcomment] [data-action=cancel]":"onCommentStreamAddCancel","click [data-type=stream-newcomment] [data-action=save]":"onCommentStreamAddSave","click [data-type=stream-comment] [data-action=edit]":"onCommentStreamEdit","click [data-type=stream-comment] [data-action=attach]":"onCommentStreamAddAttach","click [data-type=stream-comment] [data-action=remove-attach]":"onCommentStreamAddRemoveAttach","click [data-type=stream-comment] [data-action=cancel]":"onCommentStreamEditCancel","click [data-type=stream-comment] [data-action=save]":"onCommentStreamEditSave","click [data-type=stream-comment] [data-action=remove]":"onCommentStreamRemove","click [data-type=stream-comment] [data-action=remove-tag]":"onCommentStreamRemoveTag","click [data-type=stream-comment] [data-action=remove-preview]":"onCommentStreamRemovePreview","click .joms-stream-thumb":"onPreviewThumbnail"},render:function(){this.initUploader()},onEditStream:function(e){e.preventDefault();var i=t(e.target),s=this.getContainer(i),o=s.children("[data-type=stream-content]"),a=s.children("[data-type=stream-editor]");a.is(":visible")||(o.hide(),a.show(),this.resetStreamEditor(a),this.focusTextarea(a))},onEditStreamCancel:function(t){t.preventDefault();var e=this.getContainer(t.target),i=e.children("[data-type=stream-content]"),s=e.children("[data-type=stream-editor]");s.is(":visible")&&(s.hide(),i.show())},onEditStreamSave:function(t){t.preventDefault();var e,i=this.getContainer(t.target),s=i.children("[data-type=stream-content]"),o=i.children("[data-type=stream-editor]"),a=this;o.is(":visible")&&(e=o.find("textarea"),e.textntags("val",function(t){t=t.replace(/^\s+|\s+$/g,""),t?(joms.stream.ajaxSaveStatus(a.getStreamId(i),t),o.hide()):(o.hide(),s.show())}))},onCommentStreamAdd:function(t){t.preventDefault();var e=this.getContainer(t.target),i=e.find("[data-type=stream-newcomment]");i.is(":visible")||(i.show(),this.resetStreamEditor(i,!0),this.focusTextarea(i),this.hideAddCommentButton(e),this.uploaderAttachment=e.find("[data-type=stream-newcomment]").find(".joms-stream-attachment"),this.uploaderAttachment.hide())},onCommentStreamAddAttach:function(e){e.preventDefault(),this.uploader||this.initUploader(),this.uploaderButton.click(),this.uploaderTarget=t(e.target),this.uploaderAttachment=this.uploaderTarget.closest("form, .cStream-Form").find(".joms-stream-attachment")},onCommentStreamAddRemoveAttach:function(e){var i=t(e.target),s=i.closest("form, .cStream-Form"),o=s.find(".joms-stream-attachment");o.find(".joms-thumbnail img").replaceWith("<img>"),o.hide()},onAdded:function(t){t.start(),t.refresh();var e=this.uploaderAttachment,i=e.find(".joms-loading"),s=i.siblings();s.find("img").replaceWith("<img>"),s.hide(),i.show(),e.show()},onError:function(){this.uploaderAttachment.hide()},onPhotoUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(o){}s||(s={}),s.error&&(window.cWindowShow(null,"Error",450,100),window.cWindowAddContent("<div>"+s.error+"</div>",""));var a=this.uploaderAttachment;if(!s.thumb_url||!s.photo_id)return void a.hide();var n=a.find(".joms-thumbnail img");n.attr("src",s.thumb_url),n.data("photo_id",s.photo_id),a.find(".joms-loading").hide().siblings().show()},onCommentStreamAddCancel:function(t){t.preventDefault();var e=this.getContainer(t.target),i=e.find("[data-type=stream-newcomment]");i.is(":visible")&&(i.data("saving")||(i.hide(),this.showAddCommentButton(e)))},onCommentStreamAddSave:function(e){e.preventDefault();var i,o=t(e.target),a=this.getContainer(e.target),n=a.find("[data-type=stream-newcomment]"),r=this;n.is(":visible")&&(n.data("saving")||(n.data("saving",1),o.data("label",o.text()),o.html(s.get("saving")),o.prop("disabled",!0),i=n.find("textarea"),i.textntags("val",function(e){var i=!1,s=n.find(".joms-stream-attachment");return s.is(":visible")&&(i=s.find(".joms-thumbnail").find("img"),i=i.data("photo_id")),e=e.replace(/^\s+|\s+$/g,""),e||i!==!1?(jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop,n.removeData("saving"),o.html(o.data("label")),o.prop("disabled",!1)},void jax.call("community","system,ajaxStreamAddComment",r.getStreamId(a),e||"",i||"")):(n.hide(),n.removeData("saving"),o.text(o.data("label")),o.prop("disabled",!1),void r.showAddCommentButton(a))})))},onCommentStreamEdit:function(e){e.preventDefault();var i=t(e.target),s=this.getContainer(e.target),o=i.closest("[data-type=stream-comment-content]"),a=o.siblings("[data-type=stream-comment-editor]"),n=s.find("[data-type=stream-newcomment]");a.is(":visible")||(this.uploaderAttachment=a.find(".joms-stream-attachment"),n.hide(),o.hide(),a.show(),this.resetStreamEditor(a,!0),this.focusTextarea(a),this.hideAddCommentButton(s))},onCommentStreamEditCancel:function(e){e.preventDefault();var i=t(e.target),s=this.getContainer(e.target),o=i.closest("[data-type=stream-comment-editor]"),a=o.siblings("[data-type=stream-comment-content]");o.is(":visible")&&(o.data("saving")||(o.hide(),a.show(),this.showAddCommentButton(s)))},onCommentStreamEditSave:function(e){e.preventDefault();var i,o=t(e.target),a=this.getContainer(e.target),n=o.closest("[data-type=stream-comment-editor]"),r=n.siblings("[data-type=stream-comment-content]"),h=this;n.is(":visible")&&(n.data("saving")||(n.data("saving",1),o.data("label",o.text()),o.html(s.get("saving")),i=n.find("textarea"),i.textntags("val",function(i){var s,r=n.find(".joms-stream-attachment");if(r.is(":visible")?(s=r.find(".joms-thumbnail").find("img"),s=s.data("photo_id")):s=r.data("no_thumb")?"0":"-1",i=i.replace(/^\s+|\s+$/g,""),!i&&"-1"===s)return n.hide(),n.removeData("saving"),o.text(o.data("label")),o.prop("disabled",!1),h.showAddCommentButton(a),void h.onCommentStreamRemove(e);var d=n.closest("[data-type=stream-comment]").data("commentid");jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop,n.removeData("saving"),o.html(o.data("label"))},jax.call("community","system,ajaxeditComment",d,i||"",s)}),n.hide(),r.show(),this.showAddCommentButton(a)))},onCommentStreamRemove:function(e){e.preventDefault();var i,o=this;i=t(['<div><button class="btn" onclick="cWindowHide();">',s.get("no"),'</button><button class="btn btn-primary pull-right">',s.get("yes"),"</button></div>"].join("")),i.on("click",".btn-primary",function(){o.onCommentStreamRemoveConfirm(e),window.cWindowHide()}),window.cWindowShow(null,s.get("stream.remove_comment"),450,100),window.cWindowAddContent("<div>"+s.get("stream.remove_comment_message")+"</div>",i)},onCommentStreamRemoveConfirm:function(e){var i=this.getContainer(e.target),s=this;jax.loadingFunction=t.noop,jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop;var e,o=i.find("[data-type=stream-more]"),a=o.find(".wall-cmt-count");o&&o.length&&(e=+a.text(),e>1?a.text(e-1):o.remove()),s.showAddCommentButton(i)};var o=t(e.target);jax.call("community","system,ajaxStreamRemoveComment",o.data("id")||o.closest("[data-type=stream-comment]").data("commentid"))},onRemoveStreamTag:function(e){e.preventDefault();var s,o=t(e.target),a=this.getContainer(o),n=a.children("[data-type=stream-editor]"),r=n.find("textarea"),h=r.data("original")||r.val(),d=i.get("uid");d&&(s=this.getTagFromUid(h,d),s&&jax.call("community","activities,ajaxRemoveUserTag",this.getStreamId(a),s,"post"))},onCommentStreamRemoveTag:function(e){e.preventDefault();var s,o=t(e.target),a=o.closest("[data-type=stream-comment-content]"),n=a.siblings("[data-type=stream-comment-editor]"),r=n.find("textarea"),h=r.data("original")||r.val(),d=i.get("uid");d&&(s=this.getTagFromUid(h,d),s&&jax.call("community","activities,ajaxRemoveUserTag",n.closest("[data-type=stream-comment]").data("commentid"),s,"comment"))},onCommentStreamRemovePreview:function(e){e.preventDefault();var i=t(e.target).closest("[data-action=remove-preview]");i.data("removing")||(i.data("removing",1),jax.call("community","system,ajaxRemoveCommentPreview",i.closest("[data-type=stream-comment]").data("commentid")))},onPreviewThumbnail:function(t){var e=t.currentTarget,i=e.src;i=i.replace("thumb_",""),window.cWindowShow(null,"",450,0),window.cWindowAddContent('<div style="text-align:center"><img src="'+i+'"></div>')},getStreamId:function(e){return t(e).closest("li[data-streamid]").data("streamid")},getContainer:function(e){return t(e).closest("li[data-streamid]").children(".joms-stream-content")},getTagFromUid:function(t,e){if(!t||!e)return!1;var i=new RegExp("@\\[\\["+e+":contact:[^\\]]+\\]\\]"),s=t.match(i);return s&&s[0]},focusTextarea:function(t){var e,i;e=t.find("textarea").focus(),e=e[0],e&&e.setSelectionRange&&(i=e.value.length,e.setSelectionRange(i,i))},hideAddCommentButton:function(t){var e=t.find("[data-type=stream-action] [data-action=comment]"),i=t.find("[data-type=stream-reply]");e.hide(),i.hide()},showAddCommentButton:function(t){var e=t.find("[data-type=stream-action] [data-action=comment]"),i=t.find("[data-type=stream-reply]"),s=i.siblings("[data-type=stream-comment]").length,o=i.siblings("[data-type=stream-more]").length;e[s||o?"hide":"show"](),i[s||o?"show":"hide"]()},resetStreamEditor:function(e,i){var s=t(e).find("textarea"),o=s.data("initialized");o||(s.data("original",s.val()),s.data("initialized",1),this.initTextntags(s,i)),s.textntags("val",s.data("original"))},initTextntags:function(e,s){var o=this;e.textntags({triggers:{"@":{uniqueTags:!0,minChars:1}},onDataRequest:function(a,n,r,h){var d,l,c,u,p,m,v=o.getStreamId(e),f=i.get("friends")||[];l=function(e,i){var s,o;for(s=t.map(e,function(t){return""+t.id}),i=i.slice(0);i.length;)o=i.shift(),s.indexOf(""+o.id)<0&&e.push(o);return e},d=function(){o.friends||(o.friends={}),f=f.slice(0),s&&o.friends[v]&&(f=l(f,o.friends[v])),n=n.toLowerCase(),m=t.filter(f,function(t){return t.name.toLowerCase().indexOf(n)>-1}),h(m),s&&!o.friends[v]&&(u="index.php?option=com_community&view=friends&task=ajaxAutocomplete&type=comment&streamid="+v,p=i.get("settings")||{},p.isGroup?u+="&groupid="+i.get("groupid"):p.isEvent&&(u+="&eventid="+i.get("eventid")),o.fetchTextntags&&o.fetchTextntags.abort(),o.fetchTextntags=t.ajax({url:u,dataType:"json",success:function(e){var i,s=[];if(e&&e.suggestions&&e.suggestions.length){for(i=0;i<e.suggestions.length;i++)s.push({id:e.data[i],name:e.suggestions[i],avatar:e.img[i].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"});o.friends[v]=s,f=l(f,o.friends[v]),m=t.filter(f,function(t){return t.name.toLowerCase().indexOf(n)>-1}),h(m)}},complete:function(){o.fetchTextntags=!1}}))},"fetching"!==f?d():c=setInterval(function(){f=i.get("friends")||[],"fetching"!==f&&(clearInterval(c),d())},100)}})},initUploader:function(){var e={};this.uploader||(this.uploaderContainer=t('<div id="joms-comment-photo-uploader" style="width: 1px; height: 1px; overflow: hidden">').insertBefore(t("#activity-stream-container")),this.uploaderButton=t("<button>").appendTo(this.uploaderContainer),e.url="index.php?option=com_community&view=photos&task=ajaxPreviewComment",e.filters=[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],e.browse_button=this.uploaderButton,e.container=this.uploaderContainer,e.multi_selection=!1,this.uploader=new o(e),this.uploader.onAdded=t.bind(this.onAdded,this),this.uploader.onError=t.bind(this.onError,this),this.uploader.onUploaded=t.bind(this.onPhotoUploaded,this),this.uploader.init(),this.uploaderButton=this.uploaderContainer.find("input[type=file]"))}})}),i("views/stream/wall",["sandbox","views/base","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o){return e.extend({el:"#community-walls",events:{"click [data-type=wall-newcomment] [data-action=save]":"onWallAdd","start [data-type=wall-newcomment] [data-action=save]":"onWallAddStart","click [data-type=wall-newcomment] [data-action=attach]":"onWallAddAttach","click [data-type=wall-newcomment] [data-action=remove-attach]":"onWallAddRemoveAttach","click [data-type=wall-comment] [data-action=edit]":"onWallEdit","start [data-type=wall-comment] [data-action=edit]":"onWallEditStart","click [data-type=wall-comment] [data-action=attach]":"onWallAddAttach","click [data-type=wall-comment] [data-action=remove-attach]":"onWallAddRemoveAttach","click [data-type=wall-comment] [data-action=cancel]":"onWallEditCancel","click [data-type=wall-comment] [data-action=save]":"onWallEditSave","click [data-type=wall-comment] [data-action=remove-preview]":"onWallRemovePreview","click [data-type=wall-comment] [data-action=remove-thumbnail]":"onWallRemoveThumbnail","click .joms-stream-thumb":"onPreviewThumbnail"},render:function(){this._render()},_render:function(){this.$textarea=this.$(".cWall-Form [name=comment], .cMail-Compose [name=comment], .cInbox-Write [name=comment]").eq(0),this.url=this.$("[name=autocomplete_url]").val()||"",this.uniqueId=this.$("[name=unique_id]").val()||"",this.addFunction=this.$("[name=add_function]").val()||"",this.isPhotoAlbum=this.isPhoto=this.isVideo=this.isDiscussion=this.isInbox=!1;var t=this.addFunction.toLowerCase();t.indexOf("album")>-1?this.isPhotoAlbum=!0:t.indexOf("photo")>-1?this.isPhoto=!0:t.indexOf("video")>-1?this.isVideo=!0:t.indexOf("discussion")>-1?this.isDiscussion=!0:t.indexOf("inbox")>-1&&(this.isInbox=!0);var e=this.$textarea.data("initialized");e||(this.$textarea.data("original",this.$textarea.val()),this.$textarea.data("initialized",1),this.initTextntags(this.$textarea)),this.$textarea.textntags("val",this.$textarea.data("original")),this.initUploader()},onWallAdd:function(e){e.preventDefault();var i=t(e.target),o=this;this.$textarea.data("saving")||(this.$textarea.data("saving",1),i.data("label",i.text()),i.html(s.get("saving")),i.prop("disabled","disabled"),i.attr("disabled","disabled"),this.$textarea.textntags("val",function(e){var s=!1,a=i.closest("form, .cStream-Form").find(".joms-stream-attachment");return a.is(":visible")&&(s=a.find(".joms-thumbnail").find("img"),s=s.data("photo_id")),e=e.replace(/^\s+|\s+$/g,""),e||s!==!1?(jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop,o.$textarea.removeData("saving"),i.html(i.data("label")),i.prop("disabled",!1),o.$textarea.textntags("reset"),a.hide()},void(o.isVideo||o.isDiscussion?jax.call("community",o.addFunction,e,o.uniqueId,s||""):o.isInbox?jax.call("community",o.addFunction,o.uniqueId,e,s||""):jax.call("community",o.addFunction,e,o.uniqueId,"",s||""))):(o.$textarea.removeData("saving"),i.text(i.data("label")),void i.prop("disabled",!1))}))},onWallAddStart:function(){this._render()},onWallAddAttach:function(e){e.preventDefault(),this.uploader||this.initUploader(),this.uploaderButton.click(),this.uploaderTarget=t(e.target),this.uploaderAttachment=this.uploaderTarget.closest("form, .cStream-Form").find(".joms-stream-attachment")},onWallAddRemoveAttach:function(e){var i=t(e.target),s=i.closest("form, .cStream-Form"),o=s.find(".joms-stream-attachment");o.find(".joms-thumbnail img").replaceWith("<img>"),o.hide()},onAdded:function(t){t.start(),t.refresh();var e=this.uploaderAttachment,i=e.find(".joms-loading"),s=i.siblings();s.find("img").replaceWith("<img>"),s.hide(),i.show(),e.show()},onError:function(){this.uploaderAttachment.hide()},onPhotoUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(o){}s||(s={}),s.error&&(window.cWindowShow(null,"Error",450,100),window.cWindowAddContent("<div>"+s.error+"</div>",""));var a=this.uploaderAttachment;if(!s.thumb_url||!s.photo_id)return void a.hide();var n=a.find(".joms-thumbnail img");n.attr("src",s.thumb_url),n.data("photo_id",s.photo_id),a.find(".joms-loading").hide().siblings().show()},onWallEdit:function(e){e.preventDefault();var i=t(e.target).attr("rel")||"";i=i.split("::");var s=t(e.target).closest("[data-type=wall-comment]");s.data("fn",i[1]),jax.call("community","system,ajaxEditWall",i[0],i[1])},onWallEditStart:function(e){e.preventDefault();var i=t(e.target),s=i.closest("[data-type=wall-comment]"),o=s.find("textarea");o.data("original",o.val()),this.initTextntags(o),o.textntags("val",o.data("original"))},onWallEditCancel:function(e){e.preventDefault();var i=t(e.target),s=i.closest("[data-type=wall-editor]"),o=s.siblings("[data-type=wall-message]");s.is(":visible")&&(s.data("saving")||(s.hide(),o.show()))},onWallEditSave:function(e){e.preventDefault();var i,o=t(e.target),a=o.closest("[data-type=wall-editor]"),n=a.siblings("[data-type=wall-message]");a.is(":visible")&&(a.data("saving")||(a.data("saving",1),o.data("label",o.text()),o.html(s.get("saving")),o.prop("disabled","disabled"),o.attr("disabled","disabled"),i=a.find("textarea"),i.textntags("val",function(e){var i,s=a.find(".joms-stream-attachment");s.is(":visible")?(i=s.find(".joms-thumbnail").find("img"),i=i.data("photo_id")):i=s.data("no_thumb")?"0":"-1",e=e.replace(/^\s+|\s+$/g,"");var n=o.closest("[data-type=wall-comment]"),r=n.data("id"),h=n.data("fn");return e||"-1"!==i?(jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop,a.removeData("saving"),o.html(o.data("label"))},void jax.call("community","system,ajaxUpdateWall",r,e,h,i)):(a.hide(),a.removeData("saving"),o.text(o.data("label")),o.prop("disabled",!1),void("function"==typeof window.wallRemove&&window.wallRemove(r)))}),a.hide(),n.show()))},onWallRemovePreview:function(e){var i=t(e.target).closest("[data-action=remove-preview]");if(!i.data("removing")){i.data("removing",1);var s=i.closest("[data-type=wall-comment]"),o=s.data("id"),a="system,ajaxRemoveWallPreview";return this.isInbox&&(a="inbox,ajaxRemovePreview"),jax.call("community",a,o),!1}},onWallRemoveThumbnail:function(e){var i=t(e.target).closest("[data-action=remove-thumbnail]");if(!i.data("removing")){i.data("removing",1);var s=i.closest("[data-type=wall-comment]"),o=s.data("id"),a="";return this.isInbox&&(a="inbox,ajaxRemoveThumbnail"),jax.call("community",a,o),!1}},onPreviewThumbnail:function(t){var e=t.currentTarget,i=e.src;i=i.replace("thumb_",""),window.cWindowShow(null,"",450,0),window.cWindowAddContent('<div style="text-align:center"><img src="'+i+'"></div>')},initTextntags:function(e){var s=this;e.textntags({triggers:{"@":{uniqueTags:!0,minChars:1}},onDataRequest:function(e,o,a,n){if(s.isPhotoAlbum||s.isPhoto||s.isVideo||s.isDiscussion||s.isInbox){var r,h,d,l,c=s.uniqueId,u=s.url.indexOf("?")>-1?"&":"?",p=s.isPhotoAlbum,m=s.isPhoto,v=s.isVideo,f=s.isDiscussion,g=s.isInbox,b=s.url+u,w=g?[]:i.get("friends")||[];h=function(e,i){var s,o;for(s=t.map(e,function(t){return""+t.id}),i=i.slice(0);i.length;)o=i.shift(),s.indexOf(""+o.id)<0&&e.push(o);return e},r=function(){if(s.friends||(s.friends={}),w=w.slice(0),s.friends[c]&&(w=h(w,s.friends[c])),o=o.toLowerCase(),l=t.filter(w,function(t){return t.name.toLowerCase().indexOf(o)>-1
}),n(l),!s.friends[c]){if(p)b=b+"albumid="+s.uniqueId;else if(m)b=b+"photoid="+s.uniqueId+"&rule=photo-comment";else if(v)b=b+"videoid="+s.uniqueId;else if(f)b=b+"discussionid="+s.uniqueId;else{if(!g)return!1;b=b+"msgid="+s.uniqueId}s.fetchTextntags&&s.fetchTextntags.abort(),s.fetchTextntags=t.ajax({url:b,dataType:"json",success:function(e){var i,a=[];if(e&&e.suggestions&&e.suggestions.length){for(i=0;i<e.suggestions.length;i++)a.push({id:e.data[i],name:e.suggestions[i],avatar:e.img[i].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"});g&&a.length<3&&(a=[]),s.friends[c]=a,w=h(w,s.friends[c]),l=t.filter(w,function(t){return t.name.toLowerCase().indexOf(o)>-1}),n(l)}},complete:function(){s.fetchTextntags=!1}})}},"fetching"!==w?r():d=setInterval(function(){w=i.get("friends")||[],"fetching"!==w&&(clearInterval(d),r())},100)}}})},initUploader:function(){var e,i,s={};this.uploader||(this.uploaderContainer=t('<div id="joms-wall-photo-uploader" style="width: 1px; height: 1px; overflow: hidden">').insertBefore(t("#community-walls")),this.uploaderButton=t("<button>").appendTo(this.uploaderContainer),s.url="index.php?option=com_community&view=photos&task=ajaxPreviewComment",s.filters=[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],s.browse_button=this.uploaderButton,s.container=this.uploaderContainer,s.multi_selection=!1,this.uploader=new o(s),window.plupload?this.initUploaderDelay():(e=this,i=window.setInterval(function(){window.plupload&&(window.clearInterval(i),e.initUploaderDelay())},100)))},initUploaderDelay:function(){this.uploader.onAdded=t.bind(this.onAdded,this),this.uploader.onError=t.bind(this.onError,this),this.uploader.onUploaded=t.bind(this.onPhotoUploaded,this),this.uploader.init(),this.uploaderButton=this.uploaderContainer.find("input[type=file]"),this.uploaderAttachment=t("[data-type=wall-newcomment]").eq(0).find(".joms-stream-attachment")}})}),i("views/stream/layout",["sandbox","views/base","views/stream/filterbar","views/stream/item","views/stream/wall"],function(t,e,i,s,o){return e.extend({initialize:function(){this.filterbar=new i,this.item=new s,this.wall=new o},render:function(){this.filterbar.render(),this.item.render(),this.wall.render(),t(document).on("click",".dropdown-menu li a",function(){var e=t(this),i=e.closest(".joms-privacy-dropdown"),s=i.find(".dropdown-toggle").find("i"),o=i.prev(".joms-share-privacy");s&&s.length&&s.attr("class",e.find("i").attr("class")),o&&o.length&&o.html(e.find("span").html())})}})}),i("views/header/layout",["sandbox","views/base","utils/ajax"],function(t,e,i){return e.extend({render:function(){var e=t.mobile;e&&this.showCoverButtons(),this.updateNotification()},showCoverButtons:function(){var e=t(".js-focus-cover");if(e.length){var i=e.width()<=480,s=t(".js-focus-change-cover");i&&s.find("span").remove(),s.css({display:"block",zIndex:2e4})}},updateNotification:function(){var t=this;i({fn:"activities,ajaxGetTotalNotifications",data:["_dummy_"],success:function(e){e||(e={}),"undefined"!=typeof e.newNotificationCount&&(t.updateGlobalNotification(+e.newNotificationCount),t.updateModuleGlobalNotification(+e.newNotificationCount)),"undefined"!=typeof e.newFriendInviteCount&&(t.updateFriendInviteNotification(+e.newFriendInviteCount),t.updateModuleFriendInviteNotification(+e.newFriendInviteCount)),"undefined"!=typeof e.newMessageCount&&(t.updateNewMessageNotification(+e.newMessageCount),t.updateModuleNewMessageNotification(+e.newMessageCount)),e.nextPingDelay&&window.setTimeout(function(){t.updateNotification()},+e.nextPingDelay)}})},updateGlobalNotification:function(e){try{this.$globalnotif&&this.$globalnotif.length||(this.$globalnotif=t(".joms-toolbar-global-notif"));var i=this.$globalnotif,s=+i.data("count");s!==e&&(i.find("span").remove(),i.data("count",e),e&&i.append('<span class="js-counter joms-rounded">'+e+"</span>"));var o,a=/^\(\d+\)\s/,n=""+document.title;e=e?"("+e+") ":"",o=e+n.replace(a,""),o!==n&&(document.title=o)}catch(r){}},updateModuleGlobalNotification:function(e){try{this.$globalnotifmod&&this.$globalnotifmod.length||(this.$globalnotifmod=t(".joms-module-global-notif"));var i=this.$globalnotifmod,s=+i.data("count");s!==e&&(i.find("span").html(e||""),i.data("count",e))}catch(o){}},updateFriendInviteNotification:function(e){try{this.$friendnotif&&this.$friendnotif.length||(this.$friendnotif=t(".joms-toolbar-friend-invite-notif"));var i=this.$friendnotif,s=+i.data("count");s!==e&&(i.find("span").remove(),i.data("count",e),e&&i.append('<span class="js-counter joms-rounded">'+e+"</span>"))}catch(o){}},updateModuleFriendInviteNotification:function(e){try{this.$friendnotifmod&&this.$friendnotifmod.length||(this.$friendnotifmod=t(".joms-module-friend-invite-notif"));var i=this.$friendnotifmod,s=+i.data("count");s!==e&&(i.find("span").html(e||""),i.data("count",e))}catch(o){}},updateNewMessageNotification:function(e){try{this.$messagenotif&&this.$messagenotif.length||(this.$messagenotif=t(".joms-toolbar-new-message-notif"));var i=this.$messagenotif,s=+i.data("count");s!==e&&(i.find("span").remove(),i.data("count",e),e&&i.append('<span class="js-counter joms-rounded">'+e+"</span>"))}catch(o){}},updateModuleNewMessageNotification:function(e){try{this.$messagenotifmod&&this.$messagenotifmod.length||(this.$messagenotifmod=t(".joms-module-new-message-notif"));var i=this.$messagenotifmod,s=+i.data("count");s!==e&&(i.find("span").html(e||""),i.data("count",e))}catch(o){}}})}),e(["sandbox","views/postbox/layout","views/stream/layout","views/header/layout","utils/constants"],function(t,e,i,s,o){function a(){var i,s=t(".joms-postbox");s.length&&(i=new e({el:s}),i.render(),i.show())}function n(){var t=new i;t.render()}function r(){var t=new s;t.render()}function h(){var e="index.php?option=com_community&view=friends&task=ajaxAutocomplete&allfriends=1",i=o.get("settings")||{},s=[];o.set("friends","fetching"),i.isGroup?e+="&groupid="+o.get("groupid"):i.isEvent&&(e+="&eventid="+o.get("eventid")),t.ajax({url:e,dataType:"json",success:function(t){var e,i,o=[];if(t&&t.suggestions&&t.suggestions.length)for(i=0;i<t.suggestions.length;i++)e=""+t.data[i],o.indexOf(e)>=0||(o.push(e),s.push({id:e,name:t.suggestions[i],avatar:t.img[i].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"}))},complete:function(){o.set("friends",s)}})}t(function(){a(),n(),r(),+window.js_viewerId&&h()})}),i("init",function(){}),e.config({deps:["init"]}),i("bundle",function(){})}();